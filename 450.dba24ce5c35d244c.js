(self.webpackChunkGSCal=self.webpackChunkGSCal||[]).push([[450],{9450:(it,H,h)=>{"use strict";h.r(H),h.d(H,{CharacterModule:()=>Ge});var _=h(9808),c=h(3075),d=h(7790),A=h(2042),b=h(1787),T=h(1777),R=h(7579),Q=h(2722),w=h(4004),y=h(2340),q=h(1547),z=h.n(q),t=h(5e3),r=h(9880),dt=h(5113),f=h(9224),J=h(4834),v=h(288),L=h(7322),U=h(4107),k=h(508),D=h(7238),O=h(4218),G=h(5348);function pt(a,s){if(1&a&&(t.ynx(0),t._UZ(1,"mat-option",9),t.ALo(2,"number"),t.ALo(3,"translate"),t.BQk()),2&a){const e=s.$implicit;t.xp6(1),t.Q6J("value",e)("innerText",t.xi3(2,2,e.levelNum,"1.0-0")+(e.isAscend?t.lcZ(3,5,"PROPS.ASCENDED"):""))}}function ht(a,s){if(1&a&&(t.TgZ(0,"tr"),t._UZ(1,"td",10),t.ALo(2,"translate"),t.TgZ(3,"td",11),t._UZ(4,"span",12),t.ALo(5,"noComma"),t.ALo(6,"percent"),t.ALo(7,"noComma"),t.ALo(8,"number"),t.qZA()()),2&a){const e=s.$implicit,n=t.oxw(2);t.xp6(1),t.Q6J("innerText",t.lcZ(2,3,"PROPS."+e)),t.xp6(3),t.Q6J("innerText",n.selectedLevelProps[e].isPercent?t.lcZ(5,5,t.xi3(6,7,n.selectedLevelProps[e].value,"1.0-1")):t.lcZ(7,10,t.xi3(8,12,n.selectedLevelProps[e].value,"1.0-0")))("matTooltip",n.selectedLevelProps[e].value)}}function _t(a,s){if(1&a&&(t.TgZ(0,"tr"),t._UZ(1,"td",10),t.ALo(2,"translate"),t.TgZ(3,"td",11),t._UZ(4,"span",12),t.ALo(5,"noComma"),t.ALo(6,"percent"),t.ALo(7,"noComma"),t.ALo(8,"number"),t.qZA()()),2&a){const e=t.oxw().$implicit,n=t.oxw(2);t.xp6(1),t.Q6J("innerText",t.lcZ(2,3,"PROPS."+e)),t.xp6(3),t.Q6J("innerText",n.selectedLevelProps[e].isPercent?t.lcZ(5,5,t.xi3(6,7,n.selectedLevelProps[e].value,"1.0-1")):t.lcZ(7,10,t.xi3(8,12,n.selectedLevelProps[e].value,"1.0-0")))("matTooltip",n.selectedLevelProps[e].value)}}function gt(a,s){if(1&a&&(t.ynx(0),t.YNc(1,_t,9,15,"tr",0),t.BQk()),2&a){const e=s.$implicit,n=t.oxw(2);t.xp6(1),t.Q6J("ngIf",n.selectedLevelProps[e]&&0!=n.selectedLevelProps[e].value)}}function mt(a,s){1&a&&t.GkF(0)}function ut(a,s){if(1&a&&(t.TgZ(0,"td",11),t._UZ(1,"span",12),t.ALo(2,"noComma"),t.ALo(3,"percent"),t.qZA()),2&a){const e=t.oxw(2).$implicit,n=t.oxw(3);t.xp6(1),t.Q6J("innerText",t.lcZ(2,2,t.xi3(3,4,n.allData[e],"1.0-1")))("matTooltip",n.allData[e]+"")}}function ft(a,s){if(1&a&&(t.TgZ(0,"td",11),t._UZ(1,"span",12),t.ALo(2,"noComma"),t.ALo(3,"number"),t.qZA()),2&a){const e=t.oxw(2).$implicit,n=t.oxw(3);t.xp6(1),t.Q6J("innerText",t.lcZ(2,2,t.xi3(3,4,n.allData[e],"1.0-0")))("matTooltip",n.allData[e]+"")}}function xt(a,s){if(1&a&&(t.TgZ(0,"tr"),t._UZ(1,"td",10),t.ALo(2,"translate"),t.YNc(3,mt,1,0,"ng-container",13),t.YNc(4,ut,4,7,"ng-template",null,14,t.W1O),t.YNc(6,ft,4,7,"ng-template",null,15,t.W1O),t.qZA()),2&a){const e=t.MAs(5),n=t.MAs(7),i=t.oxw().$implicit,o=t.oxw(3);t.xp6(1),t.Q6J("innerText",t.lcZ(2,4,"PROPS."+i)),t.xp6(2),t.Q6J("ngIf",o.props_all_percent.includes(i))("ngIfThen",e)("ngIfElse",n)}}function Ct(a,s){if(1&a&&(t.ynx(0),t.YNc(1,xt,8,6,"tr",0),t.BQk()),2&a){const e=s.$implicit,n=t.oxw(3);t.xp6(1),t.Q6J("ngIf",0!=n.allData[e])}}function Tt(a,s){if(1&a){const e=t.EpF();t.ynx(0),t.TgZ(1,"mat-expansion-panel",4),t.NdJ("afterCollapse",function(){return t.CHM(e),t.oxw(2).onExpandStatusChanged()})("afterExpand",function(){return t.CHM(e),t.oxw(2).onExpandStatusChanged()}),t.TgZ(2,"mat-expansion-panel-header")(3,"mat-panel-title"),t._UZ(4,"span",5),t.ALo(5,"translate"),t.qZA(),t._UZ(6,"mat-panel-description"),t.qZA(),t.TgZ(7,"table"),t.YNc(8,Ct,2,1,"ng-container",8),t.qZA()(),t.BQk()}if(2&a){const e=t.oxw(2);t.xp6(1),t.Q6J("expanded",!0),t.xp6(3),t.Q6J("innerText",t.lcZ(5,3,"CHARACTER.ALLPROPS")),t.xp6(4),t.Q6J("ngForOf",e.props_all)}}function At(a,s){if(1&a){const e=t.EpF();t.ynx(0),t.TgZ(1,"mat-card",1)(2,"mat-card-header"),t._UZ(3,"div",2),t.TgZ(4,"mat-card-title"),t._uU(5),t.qZA()(),t.TgZ(6,"mat-card-content",3),t._UZ(7,"mat-divider"),t.TgZ(8,"mat-expansion-panel",4),t.NdJ("afterCollapse",function(){return t.CHM(e),t.oxw().onExpandStatusChanged()})("afterExpand",function(){return t.CHM(e),t.oxw().onExpandStatusChanged()}),t.TgZ(9,"mat-expansion-panel-header")(10,"mat-panel-title"),t._UZ(11,"span",5),t.ALo(12,"translate"),t.qZA(),t._UZ(13,"mat-panel-description"),t.qZA(),t.TgZ(14,"mat-form-field",6),t._UZ(15,"mat-label",5),t.ALo(16,"translate"),t.TgZ(17,"mat-select",7),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw().selectedLevel=i})("ngModelChange",function(i){return t.CHM(e),t.oxw().onChangeLevel(i)}),t.YNc(18,pt,4,7,"ng-container",8),t.qZA()(),t.TgZ(19,"table"),t.YNc(20,ht,9,15,"tr",8),t.YNc(21,gt,2,1,"ng-container",8),t.qZA()(),t.YNc(22,Tt,9,5,"ng-container",0),t.qZA()(),t.BQk()}if(2&a){const e=t.oxw();t.xp6(1),t.Udp("width",e.cardWidth,"px"),t.xp6(2),t.Udp("background-image",e.avatarLoadFlg?"url("+e.avatarURL+")":""),t.xp6(2),t.Oqu(e.data.name[e.currentLanguage]),t.xp6(3),t.Q6J("expanded",!0),t.xp6(3),t.Q6J("innerText",t.lcZ(12,13,"CHARACTER.PROPS")),t.xp6(4),t.Q6J("innerText",t.lcZ(16,15,"PROPS.LEVEL")),t.xp6(2),t.Q6J("ngModel",e.selectedLevel),t.xp6(1),t.Q6J("ngForOf",e.levelOptions),t.xp6(2),t.Q6J("ngForOf",e.props),t.xp6(1),t.Q6J("ngForOf",e.props_sub),t.xp6(1),t.Q6J("ngIf",e.allData)}}let vt=(()=>{class a extends r.NL{constructor(e,n,i,o,l){super(l),this.httpService=e,this.extraDataService=n,this.characterService=i,this.calculatorService=o,this.relayoutMsgService=l,this.minLevel=1,this.maxLevel=90,this.ascendLevels=[20,40,50,60,70,80,90],this.levelPadNum=2,this.props=r.hx.PROPS_CHARA_ENEMY_BASE,this.props_sub=r.hx.PROPS_CHARA_WEAPON_SUB,this.percent_props=r.hx.PROPS_CHARA_WEAPON_PERCENT,this.props_all=r.hx.PROPS_ALL_DATA,this.props_all_percent=r.hx.PROPS_ALL_DATA_PERCENT,this.draged=new t.vpe,this.levelOptions=[]}ngOnInit(){var e;this.initializeBackGroundImage();for(let n=this.minLevel;n<=this.maxLevel;++n)this.levelOptions.push({level:n.toString().padStart(this.levelPadNum,"0"),levelNum:n}),this.ascendLevels.includes(n)&&n!=this.maxLevel&&this.levelOptions.push({level:n.toString().padStart(this.levelPadNum,"0")+"+",levelNum:n,isAscend:!0});this.selectedLevel=null!==(e=this.getLevelFromString(this.characterService.getLevel(this.data.id)))&&void 0!==e?e:this.levelOptions[this.levelOptions.length-1],this.onChangeLevel(this.selectedLevel),setTimeout(()=>{this.getAllData()}),setTimeout(()=>{this.calculatorService.allDataChanged().subscribe(()=>{this.getAllData()})})}ngOnDestroy(){this.characterService.saveData()}onChangeLevel(e){this.selectedLevelProps={};let n=this.data.levelMap[e.level];for(let i in n){let o=i.toUpperCase();this.selectedLevelProps[o]={isPercent:this.percent_props.includes(o),value:n[i]}}this.characterService.setLevel(this.data.id,e.level),this.calculatorService.setDirtyFlag(this.data.id)}onDrag(){this.draged.emit(this.name)}initializeBackGroundImage(){this.avatarURL||(this.avatarLoadFlg=!1,this.httpService.get(this.data.images.icon,"blob").then(n=>{n&&(this.avatarURL=window.URL.createObjectURL(n),setTimeout(()=>{this.avatarLoadFlg=!0},100))}).catch(()=>{}))}getLevelFromString(e){if(!e)return;let n=parseInt(e),i=e.includes("+"),o=-1;for(let g=0;g<this.ascendLevels.length&&this.ascendLevels[g]<n;++g)++o;return this.levelOptions[o+(i?1:0)+n]}getAllData(){this.allData=this.calculatorService.getAllDataCache(this.data.id)}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(r.OE),t.Y36(r.Xx),t.Y36(r.AE),t.Y36(r.RO),t.Y36(r.NA))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-character"]],hostBindings:function(e,n){1&e&&t.NdJ("unload",function(){return n.ngOnDestroy()},!1,t.Jf7)},inputs:{data:"data",currentLanguage:["language","currentLanguage"],cardWidth:"cardWidth",zIndex:"zIndex",name:"name"},outputs:{draged:"draged"},features:[t.qOj],decls:1,vars:1,consts:[[4,"ngIf"],[1,"card"],["mat-card-avatar","",1,"avatar"],[1,"content"],[1,"mat-elevation-z0","expand",3,"expanded","afterCollapse","afterExpand"],[3,"innerText"],["appearance","legacy","floatLabel","always"],[3,"ngModel","ngModelChange"],[4,"ngFor","ngForOf"],[3,"value","innerText"],[1,"content-left",3,"innerText"],[1,"content-right"],["matTooltipPosition","right",3,"innerText","matTooltip"],[4,"ngIf","ngIfThen","ngIfElse"],["percent",""],["value",""]],template:function(e,n){1&e&&t.YNc(0,At,23,17,"ng-container",0),2&e&&t.Q6J("ngIf",n.data)},directives:[_.O5,f.a8,f.dk,f.kc,f.n5,f.dn,J.d,v.ib,v.yz,v.yK,v.u4,L.KE,L.hX,U.gD,c.JJ,c.On,_.sg,k.ey,D.gM],pipes:[O.X$,_.JJ,G.o,_.Zx],styles:[".card[_ngcontent-%COMP%]{max-width:350px;min-width:290px;margin:12px;transition:box-shadow .5s}.avatar[_ngcontent-%COMP%]{width:80px;height:80px;background-size:cover;margin-bottom:5px}.content[_ngcontent-%COMP%]{padding-top:2px}.expand[_ngcontent-%COMP%]{margin-top:1px}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:first-child   .content-left[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:first-child   .content-right[_ngcontent-%COMP%]{border-top:1px solid rgba(0,0,0,.12)}.content-left[_ngcontent-%COMP%]{text-align:left;border-bottom:1px solid rgba(0,0,0,.12)}.content-right[_ngcontent-%COMP%]{text-align:right;border-bottom:1px solid rgba(0,0,0,.12)}.content-right-button[_ngcontent-%COMP%]{text-align:center;border-bottom:none}.drap-handle[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px;color:#ccc;cursor:move;width:24px;height:24px}"]}),a})();var $=h(9087),V=h(24);function Lt(a,s){if(1&a&&(t._UZ(0,"mat-option",12),t.ALo(1,"number"),t.ALo(2,"translate")),2&a){const e=t.oxw().$implicit;t.Q6J("value",e)("innerText",t.xi3(1,2,e.levelNum,"1.0-0")+(e.isAscend?t.lcZ(2,5,"PROPS.ASCENDED"):""))}}function It(a,s){if(1&a&&(t.ynx(0),t.YNc(1,Lt,3,7,"mat-option",11),t.BQk()),2&a){const e=s.$implicit,n=t.oxw();t.xp6(1),t.Q6J("ngIf",e.levelNum<n.selectedWeaponAbleMaxLevel||e.levelNum==n.selectedWeaponAbleMaxLevel&&!e.isAscend)}}function St(a,s){if(1&a&&(t.TgZ(0,"tr"),t._UZ(1,"td",13),t.ALo(2,"translate"),t.TgZ(3,"td",14),t._UZ(4,"span",15),t.ALo(5,"noComma"),t.ALo(6,"percent"),t.ALo(7,"noComma"),t.ALo(8,"number"),t.qZA()()),2&a){const e=s.$implicit,n=t.oxw();t.xp6(1),t.Q6J("innerText",t.lcZ(2,3,"PROPS."+e)),t.xp6(3),t.Q6J("innerText",n.selectedLevelProps[e].isPercent?t.lcZ(5,5,t.xi3(6,7,n.selectedLevelProps[e].value,"1.0-1")):t.lcZ(7,10,t.xi3(8,12,n.selectedLevelProps[e].value,"1.0-0")))("matTooltip",n.selectedLevelProps[e].value)}}function Pt(a,s){if(1&a&&(t.TgZ(0,"tr"),t._UZ(1,"td",13),t.ALo(2,"translate"),t.TgZ(3,"td",14),t._UZ(4,"span",15),t.ALo(5,"noComma"),t.ALo(6,"percent"),t.ALo(7,"noComma"),t.ALo(8,"number"),t.qZA()()),2&a){const e=t.oxw().$implicit,n=t.oxw();t.xp6(1),t.Q6J("innerText",t.lcZ(2,3,"PROPS."+e)),t.xp6(3),t.Q6J("innerText",n.selectedLevelProps[e].isPercent?t.lcZ(5,5,t.xi3(6,7,n.selectedLevelProps[e].value,"1.0-1")):t.lcZ(7,10,t.xi3(8,12,n.selectedLevelProps[e].value,"1.0-0")))("matTooltip",n.selectedLevelProps[e].value)}}function bt(a,s){if(1&a&&(t.ynx(0),t.YNc(1,Pt,9,15,"tr",10),t.BQk()),2&a){const e=s.$implicit,n=t.oxw();t.xp6(1),t.Q6J("ngIf",n.selectedLevelProps[e]&&0!=n.selectedLevelProps[e].value)}}function Ot(a,s){if(1&a&&(t.ynx(0),t._UZ(1,"mat-option",18),t.BQk()),2&a){const e=s.$implicit,n=s.index,i=t.oxw(2);t.xp6(1),t.Q6J("value",e)("innerText",e)("disabled",n>i.selectedWeaponAbleMaxSmeltingLevel-1)}}function Et(a,s){if(1&a){const e=t.EpF();t.ynx(0),t._UZ(1,"mat-divider"),t.TgZ(2,"mat-expansion-panel",5),t.NdJ("afterCollapse",function(){return t.CHM(e),t.oxw().onExpandStatusChanged()})("afterExpand",function(){return t.CHM(e),t.oxw().onExpandStatusChanged()}),t.TgZ(3,"mat-expansion-panel-header")(4,"mat-panel-title"),t._UZ(5,"span",6),t.ALo(6,"translate"),t.qZA(),t._UZ(7,"mat-panel-description"),t.qZA(),t.TgZ(8,"mat-form-field",7),t._UZ(9,"mat-label",6),t.ALo(10,"translate"),t.TgZ(11,"mat-select",8),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw().selectedSmeltingLevel=i})("ngModelChange",function(i){return t.CHM(e),t.oxw().onChangeSmeltingLevel(i)}),t.YNc(12,Ot,2,3,"ng-container",9),t.qZA()(),t.TgZ(13,"div")(14,"span")(15,"strong"),t._uU(16),t.qZA()(),t._UZ(17,"br")(18,"span",16),t.TgZ(19,"app-extra-data",17),t._UZ(20,"br")(21,"br"),t.qZA()()(),t.BQk()}if(2&a){const e=t.oxw();t.xp6(2),t.Q6J("expanded",!0),t.xp6(3),t.Q6J("innerText",t.lcZ(6,10,"WEAPON.SMELTING")),t.xp6(4),t.Q6J("innerText",t.lcZ(10,12,"PROPS.LEVEL")),t.xp6(2),t.Q6J("ngModel",e.selectedSmeltingLevel),t.xp6(1),t.Q6J("ngForOf",e.smeltingLevelOptions),t.xp6(4),t.Oqu(e.effectName),t.xp6(2),t.Q6J("innerHTML",e.effectContent,t.oJD),t.xp6(1),t.Q6J("characterIndex",e.data.id)("skill",e.name_effect)("valueIndexs",e.effectValidIndexs)}}let Mt=(()=>{class a extends r.NL{constructor(e,n,i,o,l){super(l),this.httpService=e,this.weaponService=n,this.calculatorService=i,this.extraDataService=o,this.relayoutMsgService=l,this.notExitLevel=-1,this.minLevel=1,this.maxLevel=90,this.minSmeltingLevel=1,this.maxSmeltingLevel=5,this.defaultSmeltingLevel=this.minSmeltingLevel.toString(),this.ascendLevels=[20,40,50,60,70,80,90],this.ascendLevelsMap={5:6,4:6,3:6,2:4,1:4},this.levelPadNum=2,this.smeltingLevelPadNum=1,this.name_effect=r.hx.NAME_EFFECT,this.props=r.hx.PROPS_WEAPON_BASE,this.props_sub=r.hx.PROPS_CHARA_WEAPON_SUB,this.percent_props=r.hx.PROPS_CHARA_WEAPON_PERCENT,this.draged=new t.vpe,this.weaponList=[],this.levelOptions=[],this.smeltingLevelOptions=[]}ngOnInit(){var e,n;this.charWeaponType=this.data.weaponType,this.listFilterFunc=o=>o.weaponType==this.charWeaponType,this.initializeWeaponList();for(let o=this.minLevel;o<=this.maxLevel;++o)this.levelOptions.push({level:o.toString().padStart(this.levelPadNum,"0"),levelNum:o}),this.ascendLevels.includes(o)&&o!=this.maxLevel&&this.levelOptions.push({level:o.toString().padStart(this.levelPadNum,"0")+"+",levelNum:o,isAscend:!0});for(let o=this.minSmeltingLevel;o<=this.maxSmeltingLevel;++o)this.smeltingLevelOptions.push(o.toString().padStart(this.smeltingLevelPadNum,"0"));let i=this.weaponService.getIndex(this.data.id);if(i)this.selectedWeaponIndex=i;else for(let o=1;o<this.weaponList.length;++o)if(this.weaponList[o].weaponType==this.charWeaponType&&this.weaponList[o].rankLevel==this.maxSmeltingLevel){this.selectedWeaponIndex=this.weaponList[o].index;break}this.selectedLevel=null!==(e=this.getLevelFromString(this.weaponService.getLevel(this.data.id)))&&void 0!==e?e:this.levelOptions[this.levelOptions.length-1],this.selectedSmeltingLevel=null!==(n=this.getSmeltingLevelFromString(this.weaponService.getSmeltingLevel(this.data.id)))&&void 0!==n?n:this.defaultSmeltingLevel,this.onSelectWeapon(this.selectedWeaponIndex),this.onChangeLevel(this.selectedLevel),this.onChangeSmeltingLevel(this.selectedSmeltingLevel)}ngOnChanges(e){e.currentLanguage&&(null!=this.effectNameRecord&&(this.effectName=this.effectNameRecord[this.currentLanguage]),null!=this.effectContentRecord&&(this.effectContent=this.effectContentRecord[this.currentLanguage]))}updateRecords(){this.weaponData.skillAffixMap?(this.effectNameRecord=this.getEffectName(this.selectedSmeltingLevel),this.effectContentRecord=this.getEffectContent(this.selectedSmeltingLevel),this.effectValidIndexs=this.getEffectValidIndexs(this.selectedSmeltingLevel),this.effectName=this.effectNameRecord[this.currentLanguage],this.effectContent=this.effectContentRecord[this.currentLanguage]):(this.effectValidIndexs=[],this.effectName="",this.effectContent="")}ngOnDestroy(){this.weaponService.saveData()}onSelectWeapon(e){var n;this.selectedWeaponIndex=e;let i=this.notExitLevel;this.weaponData&&(i=this.ascendLevels[this.ascendLevelsMap[this.weaponData.rankLevel]],this.weaponService.clearExtraData(this.data.id)),this.weaponData=this.weaponService.get(e),y.N.outputLog&&console.log(this.weaponData),this.selectedWeaponAbleMaxLevel=this.ascendLevels[this.ascendLevelsMap[this.weaponData.rankLevel]],this.selectedWeaponAbleMaxSmeltingLevel=Object.keys(null!==(n=this.weaponData.skillAffixMap)&&void 0!==n?n:{}).length,0!=this.selectedWeaponAbleMaxSmeltingLevel&&parseInt(this.selectedSmeltingLevel)>this.selectedWeaponAbleMaxSmeltingLevel&&(this.selectedSmeltingLevel=this.selectedWeaponAbleMaxSmeltingLevel.toString(),this.weaponService.setSmeltingLevel(this.data.id,this.selectedSmeltingLevel),this.calculatorService.initExtraWeaponData(this.data.id)),this.weaponService.setDefaultExtraData(this.data.id,e),this.calculatorService.initWeaponData(this.data.id,e),this.onChangeLevel(this.selectedLevel),this.updateRecords(),this.initializeBackGroundImage(),this.weaponService.setIndex(this.data.id,this.weaponData.id)}onChangeLevel(e){this.selectedLevelProps={};let n=this.weaponData.levelMap[e.level];for(let i in n){let o=i.toUpperCase();this.selectedLevelProps[o]={isPercent:this.percent_props.includes(o),value:n[i]}}this.weaponService.setLevel(this.data.id,e.level),this.calculatorService.setDirtyFlag(this.data.id)}onChangeSmeltingLevel(e){this.weaponService.setSmeltingLevel(this.data.id,e),this.calculatorService.initExtraWeaponData(this.data.id),this.updateRecords()}getEffectName(e){return this.weaponData.skillAffixMap[e].name}getEffectContent(e){return this.weaponData.skillAffixMap[e].desc}getEffectValidIndexs(e){return this.weaponData.skillAffixMap[e].paramValidIndexs}onDrag(){this.draged.emit(this.name)}initializeBackGroundImage(){this.avatarLoadFlg=!1,this.httpService.get(this.weaponData.images.icon,"blob").then(n=>{n&&(this.avatarURL=window.URL.createObjectURL(n),setTimeout(()=>{this.avatarLoadFlg=!0},100))}).catch(()=>{})}initializeWeaponList(){this.weaponList=[];let e=this.weaponService.getMap();for(let n in e)this.weaponList.push({index:n,names:e[n].name,rankLevel:e[n].rankLevel,weaponType:e[n].weaponType})}getLevelFromString(e){if(!e)return;let n=parseInt(e),i=e.includes("+"),o=-1;for(let g=0;g<this.ascendLevels.length&&this.ascendLevels[g]<n;++g)++o;return this.levelOptions[o+(i?1:0)+n]}getSmeltingLevelFromString(e){if(e)return e}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(r.OE),t.Y36(r.kv),t.Y36(r.RO),t.Y36(r.Xx),t.Y36(r.NA))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-weapon"]],hostBindings:function(e,n){1&e&&t.NdJ("unload",function(){return n.ngOnDestroy()},!1,t.Jf7)},inputs:{data:"data",currentLanguage:["language","currentLanguage"],cardWidth:"cardWidth",zIndex:"zIndex",name:"name"},outputs:{draged:"draged"},features:[t.qOj,t.TTD],decls:23,vars:23,consts:[[1,"card"],["mat-card-avatar","",1,"avatar"],[1,"header-text"],[3,"title","model","OriginList","OriginListFilterFunc","OptionValueProperty","OptionInnerTextProperty","currentLanguage","modelChange"],[1,"content"],[1,"mat-elevation-z0","expand",3,"expanded","afterCollapse","afterExpand"],[3,"innerText"],["appearance","legacy","floatLabel","always"],[3,"ngModel","ngModelChange"],[4,"ngFor","ngForOf"],[4,"ngIf"],[3,"value","innerText",4,"ngIf"],[3,"value","innerText"],[1,"content-left",3,"innerText"],[1,"content-right"],["matTooltipPosition","right",3,"innerText","matTooltip"],[3,"innerHTML"],[3,"characterIndex","skill","valueIndexs"],[3,"value","innerText","disabled"]],template:function(e,n){1&e&&(t.ynx(0),t.TgZ(1,"mat-card",0)(2,"mat-card-header"),t._UZ(3,"div",1),t.TgZ(4,"mat-card-title",2)(5,"app-mat-filtering-selector",3),t.NdJ("modelChange",function(o){return n.onSelectWeapon(o)}),t.qZA()()(),t.TgZ(6,"mat-card-content",4),t._UZ(7,"mat-divider"),t.TgZ(8,"mat-expansion-panel",5),t.NdJ("afterCollapse",function(){return n.onExpandStatusChanged()})("afterExpand",function(){return n.onExpandStatusChanged()}),t.TgZ(9,"mat-expansion-panel-header")(10,"mat-panel-title"),t._UZ(11,"span",6),t.ALo(12,"translate"),t.qZA(),t._UZ(13,"mat-panel-description"),t.qZA(),t.TgZ(14,"mat-form-field",7),t._UZ(15,"mat-label",6),t.ALo(16,"translate"),t.TgZ(17,"mat-select",8),t.NdJ("ngModelChange",function(o){return n.selectedLevel=o})("ngModelChange",function(o){return n.onChangeLevel(o)}),t.YNc(18,It,2,1,"ng-container",9),t.qZA()(),t.TgZ(19,"table"),t.YNc(20,St,9,15,"tr",9),t.YNc(21,bt,2,1,"ng-container",9),t.qZA()(),t.YNc(22,Et,22,14,"ng-container",10),t.qZA()(),t.BQk()),2&e&&(t.xp6(1),t.Udp("width",n.cardWidth,"px"),t.xp6(2),t.Udp("background-image",n.avatarLoadFlg?"url("+n.avatarURL+")":""),t.xp6(2),t.Q6J("title","WEAPON.NAME")("model",n.selectedWeaponIndex)("OriginList",n.weaponList)("OriginListFilterFunc",n.listFilterFunc)("OptionValueProperty","index")("OptionInnerTextProperty","names")("currentLanguage",n.currentLanguage),t.xp6(3),t.Q6J("expanded",!0),t.xp6(3),t.Q6J("innerText",t.lcZ(12,19,"WEAPON.PROPS")),t.xp6(4),t.Q6J("innerText",t.lcZ(16,21,"PROPS.LEVEL")),t.xp6(2),t.Q6J("ngModel",n.selectedLevel),t.xp6(1),t.Q6J("ngForOf",n.levelOptions),t.xp6(2),t.Q6J("ngForOf",n.props),t.xp6(1),t.Q6J("ngForOf",n.props_sub),t.xp6(1),t.Q6J("ngIf",n.weaponData.skillAffixMap))},directives:[f.a8,f.dk,f.kc,f.n5,$.X,f.dn,J.d,v.ib,v.yz,v.yK,v.u4,L.KE,L.hX,U.gD,c.JJ,c.On,_.sg,_.O5,k.ey,D.gM,V.f],pipes:[O.X$,_.JJ,G.o,_.Zx],styles:[".card[_ngcontent-%COMP%]{max-width:350px;min-width:290px;margin:12px;transition:box-shadow .5s}.avatar[_ngcontent-%COMP%]{width:80px;height:80px;background-size:cover;margin-bottom:5px;border-radius:0%}.header-text[_ngcontent-%COMP%]{font-size:inherit}.content[_ngcontent-%COMP%]{padding-top:2px}.expand[_ngcontent-%COMP%]{margin-top:1px}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:first-child   .content-left[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:first-child   .content-right[_ngcontent-%COMP%]{border-top:1px solid rgba(0,0,0,.12)}.content-left[_ngcontent-%COMP%]{text-align:left;border-bottom:1px solid rgba(0,0,0,.12)}.content-right[_ngcontent-%COMP%]{text-align:right;border-bottom:1px solid rgba(0,0,0,.12)}.content-right-button[_ngcontent-%COMP%]{text-align:center;border-bottom:none}.drap-handle[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px;color:#ccc;cursor:move;width:24px;height:24px}"]}),a})();function yt(a,s){1&a&&t.GkF(0)}function Zt(a,s){if(1&a&&(t.TgZ(0,"mat-option",9),t._UZ(1,"span",6),t.ALo(2,"translate"),t.qZA()),2&a){const e=s.$implicit;t.Q6J("value",e),t.xp6(1),t.Q6J("innerText",t.lcZ(2,2,"GENSHIN.OTHER."+e))}}function Nt(a,s){if(1&a){const e=t.EpF();t.ynx(0),t.TgZ(1,"mat-form-field",5),t._UZ(2,"mat-label",6),t.ALo(3,"translate"),t.TgZ(4,"mat-select",7),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw(2).onChangeElement(i)}),t._UZ(5,"mat-option"),t.YNc(6,Zt,3,4,"mat-option",8),t.qZA()(),t.BQk()}if(2&a){const e=t.oxw(2);t.xp6(2),t.Q6J("innerText",t.lcZ(3,3,"GENSHIN.OTHER.OVERRIDE_ELEMENT")),t.xp6(2),t.Q6J("ngModel",e.overrideElement),t.xp6(2),t.Q6J("ngForOf",e.elementList)}}function Rt(a,s){if(1&a&&(t.ynx(0),t.TgZ(1,"tr")(2,"td",10),t._UZ(3,"div",11),t.qZA()(),t.TgZ(4,"tr"),t._UZ(5,"td",6),t.TgZ(6,"td"),t._UZ(7,"span",12),t.qZA()(),t.TgZ(8,"tr")(9,"td",10),t._UZ(10,"app-extra-data",13),t.qZA()(),t.BQk()),2&a){const e=s.$implicit,n=s.index,i=t.oxw(2);t.xp6(5),t.Q6J("innerText",e.desc),t.xp6(2),t.Q6J("innerText",i.showValues[n])("matTooltip",i.tipValues[n]),t.xp6(3),t.Q6J("characterIndex",i.data.id)("skill",i.skill)("valueIndexs",e.valuePropIndexs)("overrideElement",i.overrideElement)}}function wt(a,s){if(1&a&&(t.YNc(0,Nt,7,5,"ng-container",3),t.TgZ(1,"table"),t.YNc(2,Rt,11,7,"ng-container",4),t.qZA()),2&a){const e=t.oxw();t.Q6J("ngIf","normal"==e.skill),t.xp6(2),t.Q6J("ngForOf",e.skillDescDatas)}}function Jt(a,s){}let Dt=(()=>{class a{constructor(e,n,i,o,l){this.percentPipe=e,this.decimalPipe=n,this.noCommaPipe=i,this.calculatorService=o,this.characterService=l}ngOnInit(){this.isNormal="normal"==this.skill,this.isNormal&&(this.elementChangedSub=this.characterService.getOverrideElementChanged().subscribe(()=>{this.overrideElement=this.characterService.getOverrideElement(this.data.id)})),this.initDatas()}ngOnChanges(e){(e.currentLanguage||e.skillLevelIndex)&&this.initDatas()}ngOnDestroy(){this.isNormal&&!this.elementChangedSub.closed&&this.elementChangedSub.unsubscribe()}onChangeElement(e){this.overrideElement=e,this.characterService.setOverrideElement(this.data.id,e)}initDatas(){this.skillDescDatas=this.getCharSkillDescObject(this.skill,this.currentLanguage),this.showValues=[],this.tipValues=[];for(let e of this.skillDescDatas)this.showValues.push(this.getTalentValue(this.skill,e,this.currentLanguage,this.skillLevelIndex)),this.tipValues.push(this.getTalentValue(this.skill,e,this.currentLanguage,this.skillLevelIndex,!0));this.overrideElement=this.characterService.getOverrideElement(this.data.id),this.elementList=r.hx.PROPS_ELEMENTS}getDataProperty(e){return this.data.skills[e]}getDataProperties(e){return this.data.skills[e]}getCharSkillDescObject(e,n){return this.getDataProperty(e).paramDescSplitedList[n]}getTalentValue(e,n,i,o,l=!1){let g=n.prefix,p=[];n.valuePropIndexs.forEach((u,m)=>{let C=this.data.skills[e].paramMap[o][u];l||(C=n.isPercent[m]?this.percentPipe.transform(C,"1.0-1"):this.noCommaPipe.transform(this.decimalPipe.transform(C,"1.0-1"))),p.push(`${C}`)});let x=0,E=n.middles.length;for(let u=0;u<p.length;++u)g+=p[u],x<E&&(g+=n.middles[x++]);return g+=n.suffix,g}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(_.Zx),t.Y36(_.JJ),t.Y36(r.od),t.Y36(r.RO),t.Y36(r.AE))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-extra-info"]],inputs:{data:"data",skill:"skill",currentLanguage:["language","currentLanguage"],skillLevelIndex:"skillLevelIndex",hasLevel:"hasLevel"},features:[t.TTD],decls:5,vars:3,consts:[[4,"ngIf","ngIfThen","ngIfElse"],["skills",""],["other",""],[4,"ngIf"],[4,"ngFor","ngForOf"],["appearance","legacy","floatLabel","always"],[3,"innerText"],[3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["colspan","2"],[1,"placeholder"],["matTooltipPosition","right",3,"innerText","matTooltip"],[3,"characterIndex","skill","valueIndexs","overrideElement"]],template:function(e,n){if(1&e&&(t.YNc(0,yt,1,0,"ng-container",0),t.YNc(1,wt,3,2,"ng-template",null,1,t.W1O),t.YNc(3,Jt,0,0,"ng-template",null,2,t.W1O)),2&e){const i=t.MAs(2),o=t.MAs(4);t.Q6J("ngIf",n.hasLevel)("ngIfThen",i)("ngIfElse",o)}},directives:[_.O5,L.KE,L.hX,U.gD,c.JJ,c.On,k.ey,_.sg,D.gM,V.f],pipes:[O.X$],styles:["table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-of-type(1)   td[_ngcontent-%COMP%]{border-top:1px solid rgba(0,0,0,.12)}tr[_ngcontent-%COMP%]:nth-of-type(3n+2)   td[_ngcontent-%COMP%]:nth-of-type(1){text-align:left}tr[_ngcontent-%COMP%]:nth-of-type(3n+2)   td[_ngcontent-%COMP%]:nth-of-type(2){text-align:right}tr[_ngcontent-%COMP%]:nth-of-type(3n+3)   td[_ngcontent-%COMP%]:nth-of-type(1){text-align:left;border-bottom:1px solid rgba(0,0,0,.12)}tr[_ngcontent-%COMP%]:nth-of-type(3n+3)   td[_ngcontent-%COMP%]:nth-of-type(2){text-align:right;border-bottom:1px solid rgba(0,0,0,.12)}.placeholder[_ngcontent-%COMP%]{height:2px}"]}),a})();function Ft(a,s){if(1&a&&(t.ynx(0),t._UZ(1,"mat-option",11),t.BQk()),2&a){const e=s.$implicit;t.xp6(1),t.Q6J("value",e)("innerText",e.levelNum)}}function Ut(a,s){if(1&a){const e=t.EpF();t.ynx(0),t.TgZ(1,"mat-expansion-panel",5),t.NdJ("afterCollapse",function(){return t.CHM(e),t.oxw(2).onExpandStatusChanged()})("afterExpand",function(){return t.CHM(e),t.oxw(2).onExpandStatusChanged()}),t.TgZ(2,"mat-expansion-panel-header",6)(3,"mat-panel-title"),t._UZ(4,"span",2),t.qZA()(),t.TgZ(5,"mat-form-field",7),t._UZ(6,"mat-label",2),t.ALo(7,"translate"),t.TgZ(8,"mat-select",8),t.NdJ("ngModelChange",function(i){const l=t.CHM(e).$implicit;return t.oxw(2).selectedLevels[l]=i})("ngModelChange",function(i){const l=t.CHM(e).$implicit;return t.oxw(2).onChangeLevel(l,i)}),t.YNc(9,Ft,2,2,"ng-container",4),t.qZA()(),t._UZ(10,"app-extra-info",9)(11,"br")(12,"span",10),t.qZA(),t.BQk()}if(2&a){const e=s.$implicit,n=s.first,i=t.oxw(2);t.xp6(1),t.Q6J("expanded",n),t.xp6(3),t.Q6J("innerText",i.data.skills[e].name[i.currentLanguage]),t.xp6(2),t.Q6J("innerText",t.lcZ(7,11,"PROPS.LEVEL")),t.xp6(2),t.Q6J("ngModel",i.selectedLevels[e]),t.xp6(1),t.Q6J("ngForOf",i.levelOptions),t.xp6(1),t.Q6J("data",i.data)("skill",e)("language",i.currentLanguage)("hasLevel",!0)("skillLevelIndex",i.selectedLevels[e].level),t.xp6(2),t.Q6J("innerHTML",i.data.skills[e].desc[i.currentLanguage],t.oJD)}}function kt(a,s){if(1&a){const e=t.EpF();t.ynx(0),t.TgZ(1,"mat-expansion-panel",12),t.NdJ("afterCollapse",function(){return t.CHM(e),t.oxw(3).onExpandStatusChanged()})("afterExpand",function(){return t.CHM(e),t.oxw(3).onExpandStatusChanged()}),t.TgZ(2,"mat-expansion-panel-header",6)(3,"mat-panel-title"),t._UZ(4,"span",2),t.qZA()(),t._UZ(5,"app-extra-info",9)(6,"br")(7,"span",10),t.qZA(),t.BQk()}if(2&a){const e=t.oxw().$implicit,n=t.oxw(2);t.xp6(4),t.Q6J("innerText",n.data.skills[e].name[n.currentLanguage]),t.xp6(1),t.Q6J("data",n.data)("skill",e)("language",n.currentLanguage)("hasLevel",!0)("skillLevelIndex",n.talentDefaultLevel),t.xp6(2),t.Q6J("innerHTML",n.data.skills[e].desc[n.currentLanguage],t.oJD)}}function Qt(a,s){if(1&a&&(t.ynx(0),t.YNc(1,kt,8,7,"ng-container",0),t.BQk()),2&a){const e=s.$implicit,n=t.oxw(2);t.xp6(1),t.Q6J("ngIf",n.data.skills[e].name)}}function Bt(a,s){if(1&a){const e=t.EpF();t.ynx(0),t.TgZ(1,"mat-expansion-panel",12),t.NdJ("afterCollapse",function(){return t.CHM(e),t.oxw(4).onExpandStatusChanged()})("afterExpand",function(){return t.CHM(e),t.oxw(4).onExpandStatusChanged()}),t.TgZ(2,"mat-expansion-panel-header")(3,"mat-panel-title"),t._UZ(4,"span",2),t.qZA()(),t._UZ(5,"span",10),t.TgZ(6,"app-extra-data",13),t._UZ(7,"br")(8,"br"),t.qZA()(),t.BQk()}if(2&a){const e=s.$implicit,n=s.index,i=t.oxw(2).$implicit,o=t.oxw(2);t.xp6(4),t.Q6J("innerText",e.name[o.currentLanguage]),t.xp6(1),t.Q6J("innerHTML",e.desc[o.currentLanguage],t.oJD),t.xp6(1),t.Q6J("characterIndex",o.data.id)("skill",i)("skillIndex",n)("valueIndexs",e.paramValidIndexs)}}function Yt(a,s){if(1&a&&(t.ynx(0),t.YNc(1,Bt,9,6,"ng-container",4),t.BQk()),2&a){const e=t.oxw().$implicit,n=t.oxw(2);t.xp6(1),t.Q6J("ngForOf",n.data.skills[e])}}function Wt(a,s){if(1&a&&(t.ynx(0),t.YNc(1,Yt,2,1,"ng-container",0),t.BQk()),2&a){const e=s.$implicit,n=t.oxw(2);t.xp6(1),t.Q6J("ngIf",n.data.skills[e])}}function Ht(a,s){if(1&a&&(t.ynx(0),t.TgZ(1,"mat-card",1)(2,"mat-card-header"),t._UZ(3,"mat-card-title",2),t.ALo(4,"translate"),t.qZA(),t._UZ(5,"mat-divider"),t.TgZ(6,"mat-card-content",3)(7,"mat-accordion"),t.YNc(8,Ut,13,13,"ng-container",4),t.YNc(9,Qt,2,1,"ng-container",4),t.YNc(10,Wt,2,1,"ng-container",4),t.qZA()()(),t.BQk()),2&a){const e=t.oxw();t.xp6(1),t.Udp("width",e.cardWidth,"px"),t.xp6(2),t.Q6J("innerText",t.lcZ(4,6,"CHARACTER.TALENTS")),t.xp6(5),t.Q6J("ngForOf",e.skills),t.xp6(1),t.Q6J("ngForOf",e.otherSkills),t.xp6(1),t.Q6J("ngForOf",e.proudSkills)}}let Vt=(()=>{class a extends r.NL{constructor(e,n,i){super(i),this.characterService=e,this.calculatorService=n,this.relayoutMsgService=i,this.minLevel=1,this.maxLevel=15,this.defaultLevel=10,this.skills=[r.hx.NAME_SKILLS_NORMAL,r.hx.NAME_SKILLS_SKILL,r.hx.NAME_SKILLS_ELEMENTAL_BURST],this.otherSkills=[r.hx.NAME_SKILLS_OTHER],this.proudSkills=[r.hx.NAME_SKILLS_PROUD],this.levelPadNum=2,this.talentDefaultLevel=r.hx.NAME_TALENT_DEFAULT_LEVEL,this.props=r.hx.PROPS_CHARA_ENEMY_BASE,this.props_sub=r.hx.PROPS_CHARA_WEAPON_SUB,this.percent_props=r.hx.PROPS_CHARA_WEAPON_PERCENT,this.draged=new t.vpe,this.levelOptions=[],this.selectedLevels={}}ngOnInit(){var e,n,i;for(let o=this.minLevel;o<=this.maxLevel;++o)this.levelOptions.push({level:o.toString().padStart(this.levelPadNum,"0"),levelNum:o});for(let o of this.skills){let l;switch(o){case r.hx.NAME_SKILLS_NORMAL:l=null!==(e=this.getLevelFromString(this.characterService.getNormalLevel(this.data.id)))&&void 0!==e?e:this.levelOptions[this.defaultLevel-1];break;case r.hx.NAME_SKILLS_SKILL:l=null!==(n=this.getLevelFromString(this.characterService.getSkillLevel(this.data.id)))&&void 0!==n?n:this.levelOptions[this.defaultLevel-1];break;case r.hx.NAME_SKILLS_ELEMENTAL_BURST:l=null!==(i=this.getLevelFromString(this.characterService.getElementalBurstLevel(this.data.id)))&&void 0!==i?i:this.levelOptions[this.defaultLevel-1]}this.selectedLevels[o]=l,this.onChangeLevel(o,this.selectedLevels[o],!0)}this.calculatorService.initExtraCharacterData(this.data.id)}onChangeLevel(e,n,i=!1){switch(e){case r.hx.NAME_SKILLS_NORMAL:this.characterService.setNormalLevel(this.data.id,n.level);break;case r.hx.NAME_SKILLS_SKILL:this.characterService.setSkillLevel(this.data.id,n.level);break;case r.hx.NAME_SKILLS_ELEMENTAL_BURST:this.characterService.setElementalBurstLevel(this.data.id,n.level)}i||this.calculatorService.initExtraCharacterData(this.data.id)}onDrag(){this.draged.emit(this.name)}getLevelFromString(e){if(e)return this.levelOptions[parseInt(e)-1]}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(r.AE),t.Y36(r.RO),t.Y36(r.NA))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-talent"]],inputs:{data:"data",currentLanguage:["language","currentLanguage"],cardWidth:"cardWidth",zIndex:"zIndex",name:"name"},outputs:{draged:"draged"},features:[t.qOj],decls:1,vars:1,consts:[[4,"ngIf"],[1,"card"],[3,"innerText"],[1,"content"],[4,"ngFor","ngForOf"],[1,"mat-elevation-z0","expand",3,"expanded","afterCollapse","afterExpand"],["matTooltipPosition","right"],["appearance","legacy","floatLabel","always"],[3,"ngModel","ngModelChange"],[1,"extra-info",3,"data","skill","language","hasLevel","skillLevelIndex"],[3,"innerHTML"],[3,"value","innerText"],[1,"mat-elevation-z0","expand",3,"afterCollapse","afterExpand"],[3,"characterIndex","skill","skillIndex","valueIndexs"]],template:function(e,n){1&e&&t.YNc(0,Ht,11,8,"ng-container",0),2&e&&t.Q6J("ngIf",n.data.skills.normal.name)},directives:[_.O5,f.a8,f.dk,f.n5,J.d,f.dn,v.pp,_.sg,v.ib,v.yz,v.yK,L.KE,L.hX,U.gD,c.JJ,c.On,k.ey,Dt,V.f],pipes:[O.X$],styles:[".card[_ngcontent-%COMP%]{max-width:350px;min-width:290px;margin:12px;transition:box-shadow .5s}.avatar[_ngcontent-%COMP%]{width:80px;height:80px;background-size:cover;margin-bottom:5px}.content[_ngcontent-%COMP%]{padding-top:2px}.expand[_ngcontent-%COMP%]{margin-top:1px}.drap-handle[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px;color:#ccc;cursor:move;width:24px;height:24px}"]}),a})();function qt(a,s){if(1&a){const e=t.EpF();t.ynx(0),t.TgZ(1,"mat-expansion-panel",5),t.NdJ("afterCollapse",function(){return t.CHM(e),t.oxw(2).onExpandStatusChanged()})("afterExpand",function(){return t.CHM(e),t.oxw(2).onExpandStatusChanged()}),t.TgZ(2,"mat-expansion-panel-header")(3,"mat-panel-title"),t._UZ(4,"span",2),t.qZA()(),t._UZ(5,"span",6),t.TgZ(6,"app-extra-data",7),t._UZ(7,"br")(8,"br"),t.qZA()(),t.BQk()}if(2&a){const e=s.$implicit,n=s.index,i=t.oxw(2);t.xp6(4),t.Q6J("innerText",e.name[i.currentLanguage]),t.xp6(1),t.Q6J("innerHTML",e.desc[i.currentLanguage],t.oJD),t.xp6(1),t.Q6J("characterIndex",i.data.id)("skill",i.name_constellation)("skillIndex",n)("valueIndexs",e.paramValidIndexs)}}function zt(a,s){if(1&a&&(t.ynx(0),t.TgZ(1,"mat-card",1)(2,"mat-card-header"),t._UZ(3,"mat-card-title",2),t.ALo(4,"translate"),t.qZA(),t._UZ(5,"mat-divider"),t.TgZ(6,"mat-card-content",3)(7,"mat-accordion"),t.YNc(8,qt,9,6,"ng-container",4),t.qZA()()(),t.BQk()),2&a){const e=t.oxw();t.xp6(1),t.Udp("width",e.cardWidth,"px"),t.xp6(2),t.Q6J("innerText",t.lcZ(4,4,"CHARACTER.CONSTELLATION")),t.xp6(5),t.Q6J("ngForOf",e.data.skills.talents)}}let Gt=(()=>{class a extends r.NL{constructor(e){super(e),this.relayoutMsgService=e,this.constellationPrefix="c",this.constellationNum=[1,2,3,4,5,6],this.props=r.hx.PROPS_CHARA_ENEMY_BASE,this.props_sub=r.hx.PROPS_CHARA_WEAPON_SUB,this.percent_props=r.hx.PROPS_CHARA_WEAPON_PERCENT,this.name_constellation=r.hx.NAME_CONSTELLATION,this.draged=new t.vpe}ngOnInit(){}onDrag(){this.draged.emit(this.name)}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(r.NA))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-constellation"]],inputs:{data:"data",currentLanguage:["language","currentLanguage"],cardWidth:"cardWidth",zIndex:"zIndex",name:"name"},outputs:{draged:"draged"},features:[t.qOj],decls:1,vars:1,consts:[[4,"ngIf"],[1,"card"],[3,"innerText"],[1,"content"],[4,"ngFor","ngForOf"],[1,"mat-elevation-z0","expand",3,"afterCollapse","afterExpand"],[3,"innerHTML"],[3,"characterIndex","skill","skillIndex","valueIndexs"]],template:function(e,n){1&e&&t.YNc(0,zt,9,6,"ng-container",0),2&e&&t.Q6J("ngIf",n.data.skills.talents)},directives:[_.O5,f.a8,f.dk,f.n5,J.d,f.dn,v.pp,_.sg,v.ib,v.yz,v.yK,V.f],pipes:[O.X$],styles:[".card[_ngcontent-%COMP%]{max-width:350px;min-width:290px;margin:12px;transition:box-shadow .5s}.avatar[_ngcontent-%COMP%]{width:80px;height:80px;background-size:cover;margin-bottom:5px}.content[_ngcontent-%COMP%]{padding-top:2px}.expand[_ngcontent-%COMP%]{margin-top:1px}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:first-child   .content-left[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:first-child   .content-right[_ngcontent-%COMP%]{border-top:1px solid rgba(0,0,0,.12)}.content-left[_ngcontent-%COMP%]{text-align:left;border-bottom:1px solid rgba(0,0,0,.12)}.content-right[_ngcontent-%COMP%]{text-align:right;border-bottom:1px solid rgba(0,0,0,.12)}.content-right-button[_ngcontent-%COMP%]{text-align:center;border-bottom:none}.drap-handle[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px;color:#ccc;cursor:move;width:24px;height:24px}"]}),a})();var $t=h(327);function Xt(a,s){if(1&a&&(t.ynx(0),t._UZ(1,"mat-option",9),t.BQk()),2&a){const e=s.$implicit;t.xp6(1),t.Q6J("value",e)("innerText",e)}}function Kt(a,s){if(1&a&&(t.ynx(0),t._UZ(1,"mat-option",9),t.ALo(2,"number"),t.BQk()),2&a){const e=s.$implicit;t.xp6(1),t.Q6J("value",e)("innerText",t.xi3(2,2,e.level,"1.0-0"))}}function jt(a,s){if(1&a&&(t.TgZ(0,"tr"),t._UZ(1,"td",10),t.ALo(2,"translate"),t.TgZ(3,"td",11),t._UZ(4,"span",12),t.ALo(5,"noComma"),t.ALo(6,"percent"),t.ALo(7,"rate"),t.ALo(8,"noComma"),t.ALo(9,"number"),t.ALo(10,"rate"),t.ALo(11,"rate"),t.qZA()()),2&a){const e=s.$implicit,n=t.oxw();t.xp6(1),t.Q6J("innerText",t.lcZ(2,3,"PROPS."+e)),t.xp6(3),t.Q6J("innerText",n.selectedLevelProps[e].isPercent?t.lcZ(5,5,t.xi3(6,7,t.Dn7(7,10,n.selectedLevelProps[e].value,n.getPropRate(e),n.selectedPlayerNum-1),"1.0-1")):t.lcZ(8,14,t.xi3(9,16,t.Dn7(10,19,n.selectedLevelProps[e].value,n.getPropRate(e),n.selectedPlayerNum-1),"1.0-0")))("matTooltip",t.Dn7(11,23,n.selectedLevelProps[e].value,n.getPropRate(e),n.selectedPlayerNum-1))}}function te(a,s){if(1&a&&(t.TgZ(0,"tr"),t._UZ(1,"td",10),t.ALo(2,"translate"),t.TgZ(3,"td",11),t._UZ(4,"span",12),t.ALo(5,"noComma"),t.ALo(6,"percent"),t.ALo(7,"noComma"),t.ALo(8,"number"),t.qZA()()),2&a){const e=t.oxw().$implicit,n=t.oxw();t.xp6(1),t.Q6J("innerText",t.lcZ(2,3,"PROPS."+e)),t.xp6(3),t.Q6J("innerText",n.selectedLevelProps[e].isPercent?t.lcZ(5,5,t.xi3(6,7,n.selectedLevelProps[e].value,"1.0-1")):t.lcZ(7,10,t.xi3(8,12,n.selectedLevelProps[e].value,"1.0-0")))("matTooltip",n.selectedLevelProps[e].value)}}function ee(a,s){if(1&a&&(t.ynx(0),t.YNc(1,te,9,15,"tr",13),t.BQk()),2&a){const e=s.$implicit,n=t.oxw();t.xp6(1),t.Q6J("ngIf",n.selectedLevelProps[e])}}let ne=(()=>{class a extends r.NL{constructor(e,n,i,o,l){super(l),this.httpService=e,this.enemyService=n,this.calculatorService=i,this.extraDataService=o,this.relayoutMsgService=l,this.minLevel=1,this.maxLevel=100,this.defaultLevel=90,this.minPlayerNum=1,this.maxPlayerNum=4,this.hpRates=[1,1.5,2,2.5],this.attackRates=[1,1.1,1.25,1.4],this.levelPadNum=3,this.props=r.hx.PROPS_CHARA_ENEMY_BASE,this.props_sub=r.hx.PROPS_ENEMY_SUB,this.percent_props=r.hx.PROPS_ENEMY_PERCENT,this.draged=new t.vpe,this.enemyList=[],this.levelOptions=[],this.playerNumOptions=[]}ngOnInit(){var e,n,i;this.initializeEnemyList();for(let o=this.minLevel;o<=this.maxLevel;++o)this.levelOptions.push({level:o.toString().padStart(this.levelPadNum,"0"),levelNum:o});for(let o=this.minPlayerNum;o<=this.maxPlayerNum;++o)this.playerNumOptions.push(o);this.selectedEnemyIndex=null!==(e=this.enemyService.getIndex(this.data.id))&&void 0!==e?e:this.enemyList[0].index,this.selectedEnemyIndex!=this.enemyList[0].index&&null==this.enemyService.get(this.selectedEnemyIndex)&&(this.selectedEnemyIndex=this.enemyList[0].index),this.selectedPlayerNum=null!==(n=this.getPlayerNumFromNumber(this.enemyService.getPlayerNum(this.data.id)))&&void 0!==n?n:this.minPlayerNum,this.selectedLevel=null!==(i=this.getLevelFromString(this.enemyService.getLevel(this.data.id)))&&void 0!==i?i:this.levelOptions[this.defaultLevel-1],this.onSelectEnemy(this.selectedEnemyIndex),this.onChangeLevel(this.selectedLevel),this.onChangePlayerNum(this.selectedPlayerNum)}ngOnDestroy(){this.enemyService.saveData()}onSelectEnemy(e){this.selectedEnemyIndex=e,this.enemyData=this.enemyService.get(e),y.N.outputLog&&console.log(this.enemyData),this.calculatorService.initEnemyData(this.data.id,e),this.enemyService.setIndex(this.data.id,this.enemyData.id),this.onChangeLevel(this.selectedLevel)}onChangeLevel(e){this.selectedLevelProps={};let n=this.enemyData.levelMap[e.level];for(let i in n){let o=i.toUpperCase();this.selectedLevelProps[o]={isPercent:this.percent_props.includes(o),value:n[i]}}this.enemyService.setLevel(this.data.id,e.level),this.calculatorService.setDirtyFlag(this.data.id)}onChangePlayerNum(e){this.enemyService.setPlayerNum(this.data.id,e)}getPropRate(e){return this[e.toLocaleLowerCase()+"Rates"]}onDrag(){this.draged.emit(this.name)}initializeBackGroundImage(){this.avatarLoadFlg=!1,this.httpService.get(this.enemyData.images.icon,"blob").then(n=>{n&&(this.avatarURL=window.URL.createObjectURL(n),setTimeout(()=>{this.avatarLoadFlg=!0},100))}).catch(()=>{})}initializeEnemyList(e){this.enemyList=[];let n=this.enemyService.getMap();for(let i in n)this.enemyList.push({index:i,names:n[i].name,codeName:n[i].monsterName,enemyType:n[i].type})}getLevelFromString(e){if(e)return this.levelOptions[parseInt(e)-1]}getPlayerNumFromNumber(e){if(e)return e}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(r.OE),t.Y36(r.z),t.Y36(r.RO),t.Y36(r.Xx),t.Y36(r.NA))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-enemy"]],hostBindings:function(e,n){1&e&&t.NdJ("unload",function(){return n.ngOnDestroy()},!1,t.Jf7)},inputs:{data:"data",currentLanguage:["language","currentLanguage"],cardWidth:"cardWidth",zIndex:"zIndex",name:"name"},outputs:{draged:"draged"},features:[t.qOj],decls:27,vars:24,consts:[[1,"card"],[1,"header-text"],[3,"title","model","OriginList","OptionValueProperty","OptionInnerTextProperty","currentLanguage","modelChange"],["appearance","legacy","floatLabel","always"],[3,"innerText"],[3,"ngModel","ngModelChange"],[4,"ngFor","ngForOf"],[1,"content"],[1,"mat-elevation-z0","expand",3,"expanded","afterCollapse","afterExpand"],[3,"value","innerText"],[1,"content-left",3,"innerText"],[1,"content-right"],["matTooltipPosition","right",3,"innerText","matTooltip"],[4,"ngIf"]],template:function(e,n){1&e&&(t.ynx(0),t.TgZ(1,"mat-card",0)(2,"mat-card-header")(3,"mat-card-title",1)(4,"app-mat-filtering-selector",2),t.NdJ("modelChange",function(o){return n.onSelectEnemy(o)}),t.qZA(),t._UZ(5,"br"),t.TgZ(6,"mat-form-field",3),t._UZ(7,"mat-label",4),t.ALo(8,"translate"),t.TgZ(9,"mat-select",5),t.NdJ("ngModelChange",function(o){return n.selectedPlayerNum=o})("ngModelChange",function(o){return n.onChangePlayerNum(o)}),t.YNc(10,Xt,2,2,"ng-container",6),t.qZA()()()(),t.TgZ(11,"mat-card-content",7),t._UZ(12,"mat-divider"),t.TgZ(13,"mat-expansion-panel",8),t.NdJ("afterCollapse",function(){return n.onExpandStatusChanged()})("afterExpand",function(){return n.onExpandStatusChanged()}),t.TgZ(14,"mat-expansion-panel-header")(15,"mat-panel-title"),t._UZ(16,"span",4),t.ALo(17,"translate"),t.qZA(),t._UZ(18,"mat-panel-description"),t.qZA(),t.TgZ(19,"mat-form-field",3),t._UZ(20,"mat-label",4),t.ALo(21,"translate"),t.TgZ(22,"mat-select",5),t.NdJ("ngModelChange",function(o){return n.selectedLevel=o})("ngModelChange",function(o){return n.onChangeLevel(o)}),t.YNc(23,Kt,3,5,"ng-container",6),t.qZA()(),t.TgZ(24,"table"),t.YNc(25,jt,12,27,"tr",6),t.YNc(26,ee,2,1,"ng-container",6),t.qZA()()()(),t.BQk()),2&e&&(t.xp6(1),t.Udp("width",n.cardWidth,"px"),t.xp6(3),t.Q6J("title","ENEMY.NAME")("model",n.selectedEnemyIndex)("OriginList",n.enemyList)("OptionValueProperty","index")("OptionInnerTextProperty","names")("currentLanguage",n.currentLanguage),t.xp6(3),t.Q6J("innerText",t.lcZ(8,18,"ENEMY.PLAYERNUM")),t.xp6(2),t.Q6J("ngModel",n.selectedPlayerNum),t.xp6(1),t.Q6J("ngForOf",n.playerNumOptions),t.xp6(3),t.Q6J("expanded",!0),t.xp6(3),t.Q6J("innerText",t.lcZ(17,20,"ENEMY.PROPS")),t.xp6(4),t.Q6J("innerText",t.lcZ(21,22,"PROPS.LEVEL")),t.xp6(2),t.Q6J("ngModel",n.selectedLevel),t.xp6(1),t.Q6J("ngForOf",n.levelOptions),t.xp6(2),t.Q6J("ngForOf",n.props),t.xp6(1),t.Q6J("ngForOf",n.props_sub))},directives:[f.a8,f.dk,f.n5,$.X,L.KE,L.hX,U.gD,c.JJ,c.On,_.sg,k.ey,f.dn,J.d,v.ib,v.yz,v.yK,v.u4,D.gM,_.O5],pipes:[O.X$,_.JJ,G.o,_.Zx,$t.d],styles:[".card[_ngcontent-%COMP%]{max-width:350px;min-width:290px;margin:12px;transition:box-shadow .5s}.avatar[_ngcontent-%COMP%]{width:80px;height:80px;background-size:cover;margin-top:10px;margin-bottom:5px;border-radius:0%}.header-text[_ngcontent-%COMP%]{font-size:inherit}.content[_ngcontent-%COMP%]{padding-top:2px}.expand[_ngcontent-%COMP%]{margin-top:1px}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:first-child   .content-left[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:first-child   .content-right[_ngcontent-%COMP%]{border-top:1px solid rgba(0,0,0,.12)}.content-left[_ngcontent-%COMP%]{text-align:left;border-bottom:1px solid rgba(0,0,0,.12)}.content-right[_ngcontent-%COMP%]{text-align:right;border-bottom:1px solid rgba(0,0,0,.12)}.content-right-button[_ngcontent-%COMP%]{text-align:center;border-bottom:none}.drap-handle[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px;color:#ccc;cursor:move;width:24px;height:24px}"]}),a})();var B=h(3251),ot=h(6688),X=h(5245);function ae(a,s){if(1&a&&(t.TgZ(0,"mat-icon",8),t._uU(1),t.qZA()),2&a){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(e.icon)}}function ie(a,s){if(1&a&&t._UZ(0,"img",9),2&a){const e=t.oxw().$implicit;t.Udp("width",e.imgWidth,"px")("height",e.imgHeight,"px")("margin-right",e.imgRightEm,"em"),t.Q6J("src",e.imgUrl,t.LSH)}}function oe(a,s){if(1&a&&(t.O4$(),t._UZ(0,"path")),2&a){const e=s.$implicit;let n,i;t.uIk("d",null!==(n=e.d)&&void 0!==n?n:"")("style",null!==(i=e.style)&&void 0!==i?i:"",t.Ckj)}}function re(a,s){if(1&a&&(t.O4$(),t.TgZ(0,"svg",10)(1,"g"),t.YNc(2,oe,1,2,"path",2),t.qZA()()),2&a){const e=t.oxw().$implicit;t.xp6(2),t.Q6J("ngForOf",e.svgPaths)}}function se(a,s){if(1&a&&(t._UZ(0,"span",11),t.ALo(1,"translate")),2&a){const e=t.oxw().$implicit;t.Q6J("innerText",t.lcZ(1,1,"CHIP.CONTENT."+e.content.toUpperCase()))}}function le(a,s){if(1&a&&(t._UZ(0,"span",11),t.ALo(1,"translate")),2&a){const e=t.oxw().$implicit;t.Q6J("innerText",t.xi3(1,1,"CHIP.CONTENT."+e.content.toUpperCase(),e.value))}}function ce(a,s){if(1&a&&(t.ynx(0),t.TgZ(1,"mat-chip",3),t.ALo(2,"translate"),t.ALo(3,"translate"),t.YNc(4,ae,2,1,"mat-icon",4),t.YNc(5,ie,1,7,"img",5),t.YNc(6,re,3,1,"svg",6),t.YNc(7,se,2,3,"span",7),t.YNc(8,le,2,4,"span",7),t.qZA(),t.BQk()),2&a){const e=s.$implicit,n=t.oxw();t.xp6(1),t.Q6J("matTooltip",null==e.tip?"":1!=e.needValue?t.lcZ(2,8,"CHIP.TIP."+e.tip.toUpperCase()):t.xi3(3,10,"CHIP.TIP."+e.tip.toUpperCase(),e.value))("color",n.getColor(e))("selectable",!1),t.xp6(3),t.Q6J("ngIf",e.icon),t.xp6(1),t.Q6J("ngIf",e.imgUrl),t.xp6(1),t.Q6J("ngIf",e.svg),t.xp6(1),t.Q6J("ngIf",1!=e.needValue),t.xp6(1),t.Q6J("ngIf",1==e.needValue)}}let rt=(()=>{class a{constructor(e,n,i,o,l){this.genshinDataService=e,this.artifactService=n,this.percentPipe=i,this.decimalPipe=o,this.noCommaPipe=l,this.parts=[r.hx.ARTIFACT_FLOWER,r.hx.ARTIFACT_PLUME,r.hx.ARTIFACT_SANDS,r.hx.ARTIFACT_GOBLET,r.hx.ARTIFACT_CIRCLET],this.subs=[r.hx.ARTIFACT_SUB1,r.hx.ARTIFACT_SUB2,r.hx.ARTIFACT_SUB3,r.hx.ARTIFACT_SUB4],this.subMax=69,this.fixNum=1,this.dataReliquaryAffix=r.br.dataReliquaryAffix}ngOnInit(){this.nameZh=this.genshinDataService.getCharacter(this.characterIndex.toString()).name.cn_sim,this.updateChips()}ngOnChanges(e){e.changed&&this.updateChips()}updateChips(){var e,n,i,o,l;let g,p,x,E,u;this.chips=[],x=null!=this.isFull&&1==this.isFull,E=this.isAuto,p={},p[r.hx.ALL_PROPS_KEY]=0;for(let m of this.parts){let C;C=x?m:this.partName,g=this.artifactService.getStorageInfo(this.characterIndex,this.index,C.toLowerCase());for(let P of this.subs)if(u=g[P.toLowerCase()],null!=u.name){let S;E?(p[u.name+r.hx.SUFFIX_ACTUAL_KEY]=(null!==(n=p[u.name+r.hx.SUFFIX_ACTUAL_KEY])&&void 0!==n?n:0)+u.value/this.parts.length,S=this.floorIndexByDichotomy(this.dataReliquaryAffix[u.name],p[u.name+r.hx.SUFFIX_ACTUAL_KEY])):(p[u.name+r.hx.SUFFIX_ACTUAL_KEY]=(null!==(e=p[u.name+r.hx.SUFFIX_ACTUAL_KEY])&&void 0!==e?e:0)+u.value,S=this.dataReliquaryAffix[u.name].indexOf(p[u.name+r.hx.SUFFIX_ACTUAL_KEY])),p[u.name]=(null!==(i=p[u.name])&&void 0!==i?i:0)+ +(100*S/this.subMax).toFixed(this.fixNum)}if(u=g[r.hx.ARTIFACT_MAIN.toLowerCase()],null!=u.name&&(p[r.hx.ARTIFACT_MAIN+r.hx.CONCATENATION_CHIP+u.name]=(null!==(o=p[r.hx.ARTIFACT_MAIN+r.hx.CONCATENATION_CHIP+u.name])&&void 0!==o?o:0)+1,p[C+r.hx.CONCATENATION_CHIP+r.hx.ARTIFACT_MAIN+r.hx.CONCATENATION_CHIP+u.name]=1),!x)break}for(let m of r.hx.PROPS_ARTIFACT_SUB)null!=p[m]&&(p[r.hx.ALL_PROPS_KEY]=p[r.hx.ALL_PROPS_KEY]+p[m]);if(p[r.hx.ALL_PROPS_KEY]=+p[r.hx.ALL_PROPS_KEY].toFixed(this.fixNum),x&&!E)for(let m in p)if(!m.includes(r.hx.ARTIFACT_MAIN)){if(m.includes(r.hx.SUFFIX_ACTUAL_KEY)){p[m]=p[m]/this.parts.length;continue}p[m]=+(p[m]/this.parts.length).toFixed(this.fixNum)}for(let m of r.hx.PROPS_ARTIFACT_SUB)null==p[m]&&(p[m]=0,p[m+r.hx.SUFFIX_ACTUAL_KEY]=0);for(let m of r.hx.PROPS_ARTIFACT_SUB){let C="";C=r.hx.PROPS_CHIP_DECIMAL.includes(m)?this.noCommaPipe.transform(this.decimalPipe.transform(p[m+r.hx.SUFFIX_ACTUAL_KEY],"1.0-1")):this.percentPipe.transform(p[m+r.hx.SUFFIX_ACTUAL_KEY],"1.0-1"),p[m+r.hx.SUFFIX_ACTUAL_KEY+r.hx.SUFFIX_KEY_STR]=C}for(let m of this.genshinDataService.getChip(r.hx.ALL_CHARACTER_KEY).concat(null!==(l=this.genshinDataService.getChip(this.nameZh))&&void 0!==l?l:[])){if(1==m.onlyForAll&&1!=x||1==m.onlyForOne&&1==x||null==m.rules)continue;let C=!0;if(m.rules.length>0)for(let P of m.rules){if(!C)break;let S=!1;for(let I of P)if(null!=I.propName&&I.propName in p){let M=!0;if(null!=I.expectGEValue&&(M=M&&p[I.propName]>=I.expectGEValue),null!=I.expectLEValue&&(M=M&&p[I.propName]<=I.expectLEValue),S=M,S)break}C=S}if(C){let P=m;m.needValue&&(P=Object.assign(Object.assign({},m),{value:p})),this.chips.push(P)}}}getColor(e){if(null!=e.colors&&e.colors.length>0){if(1!=e.needValue)return e.colors[0];if(null!=e.colorPropName&&null!=e.colorDivides){let n=0,i=e.value[e.colorPropName];for(let o of e.colorDivides){if(!(i>o))break;++n}if(n<e.colors.length)return e.colors[n]}return e.colors[0]}return""}floorIndexByDichotomy(e,n,i,o){null==i&&(i=0),null==o&&(o=e.length-1);let l=Math.floor((i+o)/2);return l==i?i:n<e[l]?this.floorIndexByDichotomy(e,n,i,l):n>e[l]?this.floorIndexByDichotomy(e,n,l,o):l}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(r.br),t.Y36(r.bk),t.Y36(_.Zx),t.Y36(_.JJ),t.Y36(r.od))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-artifact-chips"]],inputs:{characterIndex:"characterIndex",index:"index",isFull:"isFull",isAuto:"isAuto",partName:["part","partName"],changed:"changed"},features:[t.TTD],decls:3,vars:2,consts:[["aria-label","Joyful Chip",3,"multiple"],[1,"none-display"],[4,"ngFor","ngForOf"],["matTooltipPosition","above","selected","",1,"normal-chip",3,"matTooltip","color","selectable"],["class","chip-icon",4,"ngIf"],["class","chip-img",3,"width","height","marginRight","src",4,"ngIf"],["class","svg-icon","viewBox","0 0 14 14","xmlns","http://www.w3.org/2000/svg",4,"ngIf"],[3,"innerText",4,"ngIf"],[1,"chip-icon"],[1,"chip-img",3,"src"],["viewBox","0 0 14 14","xmlns","http://www.w3.org/2000/svg",1,"svg-icon"],[3,"innerText"]],template:function(e,n){1&e&&(t.TgZ(0,"mat-chip-list",0),t._UZ(1,"mat-chip",1),t.YNc(2,ce,9,13,"ng-container",2),t.qZA()),2&e&&(t.Q6J("multiple",!0),t.xp6(2),t.Q6J("ngForOf",n.chips))},directives:[ot.qn,ot.HS,_.sg,D.gM,_.O5,X.Hw],pipes:[O.X$],styles:[".none-display[_ngcontent-%COMP%]{display:none}.normal-chip[_ngcontent-%COMP%]{font-size:1em}.chip-icon[_ngcontent-%COMP%]{transform:translate(-.1em)}.chip-img[_ngcontent-%COMP%]{transform:translate(-.2em)}.svg-icon[_ngcontent-%COMP%]{margin-left:.2em;margin-right:.12em;transform:translate(-.3em);width:20px;height:20px}.mat-white[_ngcontent-%COMP%]{background-color:#dcdcdc;color:#000;fill:#000}.mat-blue[_ngcontent-%COMP%]{background-color:#5083b1;color:#fff;fill:#fff}.mat-purple[_ngcontent-%COMP%]{background-color:#ae82c3;color:#fff;fill:#fff}.mat-gold[_ngcontent-%COMP%]{background-color:#eba543;color:#fff;fill:#fff}.mat-red[_ngcontent-%COMP%]{background-color:#e62716;color:#fff;fill:#fff}.mat-cryo[_ngcontent-%COMP%]{background-color:#187ea0;color:#fff;fill:#fff}.mat-anemo[_ngcontent-%COMP%]{background-color:#1b6d6e;color:#fff;fill:#fff}.mat-physical[_ngcontent-%COMP%]{background-color:#adb7bb;color:#000;fill:#000}.mat-electro[_ngcontent-%COMP%]{background-color:#704691;color:#fff;fill:#fff}.mat-geo[_ngcontent-%COMP%]{background-color:#a7721e;color:#fff;fill:#fff}.mat-pyro[_ngcontent-%COMP%]{background-color:#b1412b;color:#fff;fill:#fff}.mat-hydro[_ngcontent-%COMP%]{background-color:#2e66aa;color:#fff;fill:#fff}.mat-dendro[_ngcontent-%COMP%]{background-color:#296d34;color:#fff;fill:#fff}"],changeDetection:0}),a})();var st=h(8029);function de(a,s){if(1&a&&(t.TgZ(0,"mat-option",6),t._UZ(1,"span",3),t.ALo(2,"translate"),t._uU(3," - "),t._UZ(4,"span",3),t.ALo(5,"noComma"),t.ALo(6,"percent"),t.ALo(7,"noComma"),t.ALo(8,"number"),t.qZA()),2&a){const e=s.$implicit;t.Q6J("value",e.name),t.xp6(1),t.Q6J("innerText",t.lcZ(2,3,"PROPS."+e.name.toUpperCase())),t.xp6(3),t.Q6J("innerText",e.isPercent?t.lcZ(5,5,t.xi3(6,7,e.value,"1.0-1")):t.lcZ(7,10,t.xi3(8,12,e.value,"1.0-0")))}}function pe(a,s){if(1&a){const e=t.EpF();t.ynx(0),t.TgZ(1,"mat-form-field",2),t._UZ(2,"mat-label",3),t.ALo(3,"translate"),t.TgZ(4,"mat-select",4),t.NdJ("selectionChange",function(i){const l=t.CHM(e).$implicit;return t.oxw().onSelect(l,i.value)}),t._UZ(5,"mat-option"),t.YNc(6,de,9,15,"mat-option",5),t.qZA()(),t._UZ(7,"br"),t.BQk()}if(2&a){const e=s.$implicit,n=t.oxw();t.xp6(2),t.Q6J("innerText",t.lcZ(3,3,"ARTIFACT."+e)),t.xp6(2),t.Q6J("value",n.data[e.toLowerCase()].name),t.xp6(2),t.Q6J("ngForOf",n.mainList)}}function he(a,s){if(1&a&&(t.ynx(0),t.TgZ(1,"mat-option",6),t._UZ(2,"span",3),t.ALo(3,"translate"),t.qZA(),t.BQk()),2&a){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("value",e),t.xp6(1),t.Q6J("innerText",t.lcZ(3,2,"PROPS."+e.toUpperCase()))}}function _e(a,s){if(1&a&&(t.ynx(0),t.YNc(1,he,4,4,"ng-container",1),t.BQk()),2&a){const e=s.$implicit,n=t.oxw().$implicit,i=t.oxw(2);t.xp6(1),t.Q6J("ngIf",!i.isDuplicate(n.toLowerCase(),e))}}function ge(a,s){if(1&a){const e=t.EpF();t.TgZ(0,"tr")(1,"td")(2,"mat-form-field",9),t._UZ(3,"mat-label",3),t.ALo(4,"translate"),t.TgZ(5,"mat-select",4),t.NdJ("selectionChange",function(i){const l=t.CHM(e).$implicit;return t.oxw(2).onSelect(l,i.value)}),t._UZ(6,"mat-option"),t.YNc(7,_e,2,1,"ng-container",0),t.qZA()()(),t.TgZ(8,"td")(9,"mat-slider",10),t.NdJ("change",function(i){const l=t.CHM(e).$implicit,g=t.oxw(2);return g.onChangeSubSlider(i,l,g.data[l.toLowerCase()].name)}),t.qZA(),t._UZ(10,"span",11),t.ALo(11,"noComma"),t.ALo(12,"percent"),t.ALo(13,"noComma"),t.ALo(14,"number"),t.qZA()()}if(2&a){const e=s.$implicit,n=t.oxw(2);let i,o;t.xp6(3),t.Q6J("innerText",t.lcZ(4,12,"ARTIFACT."+e)),t.xp6(2),t.Q6J("value",n.data[e.toLowerCase()].name),t.xp6(2),t.Q6J("ngForOf",n.subList),t.xp6(2),t.Q6J("thumbLabel",!0)("value",n.data[e.toLowerCase()].name?n.dataReliquaryAffix[n.data[e.toLowerCase()].name].indexOf(n.data[e.toLowerCase()].value):0)("disabled",!n.data[e.toLowerCase()].name)("displayWith",n.displayWith)("max",n.subMax)("min",n.subMin)("step",n.subStep),t.xp6(1),t.Q6J("innerText",n.percent_props.includes(null!==(i=n.data[e.toLowerCase()].name)&&void 0!==i?i:"")?t.lcZ(11,14,t.xi3(12,16,null!==(i=n.data[e.toLowerCase()].value)&&void 0!==i?i:0,"1.0-1")):t.lcZ(13,19,t.xi3(14,21,null!==(i=n.data[e.toLowerCase()].value)&&void 0!==i?i:0,"1.0-0")))("matTooltip",(null!==(o=n.data[e.toLowerCase()].value)&&void 0!==o?o:0).toString())}}function me(a,s){if(1&a&&(t.ynx(0),t.TgZ(1,"table"),t.YNc(2,ge,15,24,"tr",0),t.qZA(),t.TgZ(3,"div",7),t._UZ(4,"app-artifact-chips",8),t.qZA(),t.BQk()),2&a){const e=t.oxw();t.xp6(2),t.Q6J("ngForOf",e.subs),t.xp6(2),t.Q6J("characterIndex",e.characterIndex)("index",e.index)("isAuto",e.isAuto)("part",e.artifactType)("changed",e.chipChanged)}}let ue=(()=>{class a{constructor(e,n,i,o){this.genshinDataService=e,this.artifactService=n,this.calculatorService=i,this.percentPipe=o,this.percent_props=r.hx.PROPS_CHARA_WEAPON_PERCENT,this.mains=[r.hx.ARTIFACT_MAIN],this.subs=[r.hx.ARTIFACT_SUB1,r.hx.ARTIFACT_SUB2,r.hx.ARTIFACT_SUB3,r.hx.ARTIFACT_SUB4],this.subMax=69,this.subMin=0,this.subStep=1,this.chipChangedForParent=new t.vpe,this.dataReliquaryAffix=r.br.dataReliquaryAffix,this.chipChanged=0,this.displayWith=l=>this.percentPipe.transform(l/this.subMax,"1.0-0")}ngOnInit(){this.initList(),this.initData()}ngOnChanges(e){(e.index||e.changed)&&(this.initData(),this.updateChips())}ngOnDestroy(){this.artifactService.saveData()}initList(){this.mainList=[];let n,e=r.br.dataReliquaryMain;switch(this.artifactType){case r.hx.ARTIFACT_FLOWER:n=r.hx.PROPS_ARTIFACT_FLOWER;break;case r.hx.ARTIFACT_PLUME:n=r.hx.PROPS_ARTIFACT_PLUME;break;case r.hx.ARTIFACT_SANDS:n=r.hx.PROPS_ARTIFACT_SANDS;break;case r.hx.ARTIFACT_GOBLET:n=r.hx.PROPS_ARTIFACT_GOBLET;break;case r.hx.ARTIFACT_CIRCLET:n=r.hx.PROPS_ARTIFACT_CIRCLET}for(let i of n)if(e.hasOwnProperty(i)){let o=this.percent_props.includes(i);this.mainList.push({name:i,value:e[i],isPercent:o})}this.subList=[];for(let i of r.hx.PROPS_ARTIFACT_SUB)this.subList.push(i)}initData(){this.data=this.artifactService.getStorageInfo(this.characterIndex,this.index,this.artifactType.toLowerCase())}isDuplicate(e,n){for(let i in this.data)if(e!=i&&this.data[i].name==n)return!0;return!1}onSelect(e,n){let i=e.toLowerCase();null==this.data[i]&&(this.data[i]={});for(let o in this.data)o!=e&&this.data[o].name==n&&(this.data[o].name=void 0,this.data[o].value=0);if(this.data[i].name=n,r.hx.ARTIFACT_MAIN==e){for(let o of this.mainList)if(o.name==n){this.data[i].value=o.value;break}}else this.data[i].value=0;this.calculatorService.setDirtyFlag(this.characterIndex),this.updateChips()}onChangeSubSlider(e,n,i){var o;let l=n.toLowerCase();null==this.data[l]||!this.data[l].name||(this.data[l].value=this.dataReliquaryAffix[i][null!==(o=e.value)&&void 0!==o?o:0],this.calculatorService.setDirtyFlag(this.characterIndex),this.updateChips())}updateChips(){this.chipChanged+=1,this.chipChangedForParent.emit()}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(r.br),t.Y36(r.bk),t.Y36(r.RO),t.Y36(_.Zx))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-artifact-sub"]],hostBindings:function(e,n){1&e&&t.NdJ("unload",function(){return n.ngOnDestroy()},!1,t.Jf7)},inputs:{characterIndex:"characterIndex",index:"index",artifactType:"artifactType",changed:"changed",isAuto:"isAuto"},outputs:{chipChangedForParent:"chipChanged"},features:[t.TTD],decls:2,vars:2,consts:[[4,"ngFor","ngForOf"],[4,"ngIf"],["appearance","legacy","floatLabel","always"],[3,"innerText"],[3,"value","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"chip-div"],[3,"characterIndex","index","isAuto","part","changed"],["appearance","legacy","floatLabel","always",1,"sub-field"],["color","primary","tickInterval","auto",3,"thumbLabel","value","disabled","displayWith","max","min","step","change"],["matTooltipPosition","right",1,"sub-span",3,"innerText","matTooltip"]],template:function(e,n){1&e&&(t.YNc(0,pe,8,5,"ng-container",0),t.YNc(1,me,5,6,"ng-container",1)),2&e&&(t.Q6J("ngForOf",n.mains),t.xp6(1),t.Q6J("ngIf",!n.isAuto))},directives:[_.sg,L.KE,L.hX,U.gD,k.ey,_.O5,st.pH,D.gM,rt],pipes:[O.X$,G.o,_.Zx,_.JJ],styles:[".sub-field[_ngcontent-%COMP%]{width:140px}.sub-span[_ngcontent-%COMP%]{display:inline-block;text-align:left;width:27px}table[_ngcontent-%COMP%]{width:96%;border-collapse:collapse}tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-of-type(1){text-align:left}tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-of-type(2){text-align:right}.chip-div[_ngcontent-%COMP%]{padding-top:.3em;padding-bottom:.3em}"]}),a})();var K=h(7423),Y=h(2181),fe=h(5861),xe=h(7261),lt=h(8833);function Ce(a,s){if(1&a){const e=t.EpF();t.TgZ(0,"mat-form-field",16),t._UZ(1,"mat-label",4),t.ALo(2,"translate"),t.TgZ(3,"input",17),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw(2).$implicit.onChange(i)}),t.qZA(),t.TgZ(4,"span",18),t._uU(5,"%\xa0"),t.qZA()()}if(2&a){const e=t.oxw(2).$implicit;t.xp6(1),t.Q6J("innerText",t.lcZ(2,2,"AUTO."+e.title)),t.xp6(2),t.Q6J("formControlName",e.model)}}function Te(a,s){1&a&&t._UZ(0,"mat-option",21)}function Ae(a,s){if(1&a&&(t._UZ(0,"mat-option",23),t.ALo(1,"translate")),2&a){const e=t.oxw().$implicit,n=t.oxw(3).$implicit;t.Q6J("value",e)("innerText",t.lcZ(1,2,n.optionTranslationTag+e))}}function ve(a,s){if(1&a&&(t._UZ(0,"mat-option",23),t.ALo(1,"translate")),2&a){const e=t.oxw().$implicit,n=t.oxw(3).$implicit;t.Q6J("value",e)("innerText",t.lcZ(1,2,n.optionTranslationTag+n.optionNameMap[e]))}}function Le(a,s){if(1&a&&(t.ynx(0),t.YNc(1,Ae,2,4,"mat-option",22),t.YNc(2,ve,2,4,"mat-option",22),t.BQk()),2&a){const e=t.oxw(3).$implicit;t.xp6(1),t.Q6J("ngIf",!e.useNameMap),t.xp6(1),t.Q6J("ngIf",e.useNameMap)}}function Ie(a,s){if(1&a){const e=t.EpF();t.TgZ(0,"mat-form-field",16),t._UZ(1,"mat-label",4),t.ALo(2,"translate"),t.TgZ(3,"mat-select",19),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw(2).$implicit.onChange(i)}),t.YNc(4,Te,1,0,"mat-option",20),t.YNc(5,Le,3,2,"ng-container",10),t.qZA()()}if(2&a){const e=t.oxw(2).$implicit,n=t.oxw();t.xp6(1),t.Q6J("innerText",t.lcZ(2,4,"AUTO."+e.title)),t.xp6(2),t.Q6J("formControlName",e.model),t.xp6(1),t.Q6J("ngIf",e.hasEmpty),t.xp6(1),t.Q6J("ngForOf",n.userInputList[e.selectListName])}}function Se(a,s){if(1&a&&(t.TgZ(0,"tr")(1,"td",2),t._UZ(2,"span",4),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"td",5),t.YNc(5,Ce,6,4,"mat-form-field",15),t.YNc(6,Ie,6,6,"mat-form-field",15),t.qZA()()),2&a){const e=t.oxw().$implicit;t.xp6(2),t.Q6J("innerText",t.lcZ(3,3,"AUTO."+e.name)),t.xp6(3),t.Q6J("ngIf",e.isInput),t.xp6(1),t.Q6J("ngIf",e.isSelect)}}function Pe(a,s){if(1&a&&(t.ynx(0),t.YNc(1,Se,7,5,"tr",14),t.BQk()),2&a){const e=s.$implicit,n=t.oxw();t.xp6(1),t.Q6J("ngIf",!e.isSelect||n.userInputList[e.selectListName].length>0)}}let be=(()=>{class a{constructor(e,n,i,o,l,g){this.artifactService=e,this.genshinDataService=n,this.calculatorService=i,this.percentPipe=o,this.matSnackBar=l,this.translateService=g,this.optimalStep=10,this.step=1,this.minValid=0,this.maxValid=45*this.optimalStep,this.maxValidEffective3=40*this.optimalStep,this.maxValidEffective2=35*this.optimalStep,this.maxValidEffective1=30*this.optimalStep,this.maxValidArray=[this.maxValidEffective1,this.maxValidEffective2,this.maxValidEffective3,this.maxValid],this.damageTypeNameMap={originDmg:"ORIGIN",critDmg:"CRIT",expectDmg:"EXPECT",originVaporizeDmg:"ORIGIN_VAPORIZE",cirtVaporizeDmg:"CRIT_VAPORIZE",expectVaporizeDmg:"EXPECT_VAPORIZE",originMeltDmg:"ORIGIN_MELT",cirtMeltDmg:"CRIT_MELT",expectMeltDmg:"EXPECT_MELT",originAggravateDmg:"ORIGIN_AGGRAVATE",cirtAggravateDmg:"CRIT_AGGRAVATE",expectAggravateDmg:"EXPECT_AGGRAVATE",originSpreadDmg:"ORIGIN_SPREAD",cirtSpreadDmg:"CRIT_SPREAD",expectSpreadDmg:"EXPECT_SPREAD",overloadedDmg:"OVERLOADED",burningDmg:"BURNING",electroChargedDmg:"ELECTROCHARGED",superconductDmg:"SUPERCONDUCT",ruptureDmg:"RUPTURE",burgeonDmg:"BURGEON",hyperbloomDmg:"HYPERBLOOM",swirlCryoDmg:"SWIRL_CRYO",swirlElectroDmg:"SWIRL_ELECTRO",swirlElectroAggravateDmg:"SWIRL_ELECTRO_AGGRAVATE",swirlPyroDmg:"SWIRL_PYRO",swirlHydroDmg:"SWIRL_HYDRO",shieldHp:"SHIELD",destructionDmg:"DESTRUCTION",healing:"HEALING",product:"PRODUCT",shield:"SHIELD"},this.subs=r.hx.PROPS_OPTIMAL_ARTIFACT_SUB,this.subsMap=new Map([[r.hx.PROP_CRIT_RATE,1],[r.hx.PROP_CRIT_DMG,2],[r.hx.PROP_ATTACK_UP,3],[r.hx.PROP_HP_UP,4],[r.hx.PROP_DEFENSE_UP,5],[r.hx.PROP_ELEMENTAL_MASTERY,6],[r.hx.PROP_ENERGY_RECHARGE,7]]),this.subsSlotMap=new Map([[r.hx.PROP_CRIT_RATE,[r.hx.ARTIFACT_FLOWER.toLowerCase(),r.hx.ARTIFACT_SUB1.toLowerCase()]],[r.hx.PROP_CRIT_DMG,[r.hx.ARTIFACT_FLOWER.toLowerCase(),r.hx.ARTIFACT_SUB2.toLowerCase()]],[r.hx.PROP_ATTACK_UP,[r.hx.ARTIFACT_FLOWER.toLowerCase(),r.hx.ARTIFACT_SUB3.toLowerCase()]],[r.hx.PROP_HP_UP,[r.hx.ARTIFACT_FLOWER.toLowerCase(),r.hx.ARTIFACT_SUB4.toLowerCase()]],[r.hx.PROP_DEFENSE_UP,[r.hx.ARTIFACT_PLUME.toLowerCase(),r.hx.ARTIFACT_SUB1.toLowerCase()]],[r.hx.PROP_ELEMENTAL_MASTERY,[r.hx.ARTIFACT_PLUME.toLowerCase(),r.hx.ARTIFACT_SUB2.toLowerCase()]],[r.hx.PROP_ENERGY_RECHARGE,[r.hx.ARTIFACT_PLUME.toLowerCase(),r.hx.ARTIFACT_SUB3.toLowerCase()]]]),this.defaultPoint=250,this.inputItemsMix=[{name:"DAMAGE_RATE",title:"DAMAGE_RATE",isInput:!0,isRequire:!0,model:"damageRate",onChange:this.setDamageRate.bind(this)},{name:"DAMAGE_BASE",title:"DAMAGE_BASE",isSelect:!0,isRequire:!0,hasEmpty:!0,selectListName:"damageBaseList",optionTranslationTag:"PROPS.",model:"damageBase",onChange:this.setDamageBase.bind(this)},{name:"DAMAGE_RATE_ATTACH",title:"DAMAGE_RATE_ATTACH",isInput:!0,isRequire:!1,model:"damageRateAttach",onChange:this.setDamageRateAttach.bind(this)},{name:"DAMAGE_BASE_ATTACH",title:"DAMAGE_BASE_ATTACH",isSelect:!0,isRequire:!1,hasEmpty:!0,selectListName:"damageBaseList",optionTranslationTag:"PROPS.",model:"damageBaseAttach",onChange:this.setDamageBaseAttach.bind(this)},{name:"ELEMENT_TYPE",title:"ELEMENT_TYPE",isSelect:!0,isRequire:!0,hasEmpty:!0,selectListName:"elementTypeList",optionTranslationTag:"PROPS.",model:"elementType",onChange:this.setElementType.bind(this)},{name:"ATTACK_TYPE",title:"ATTACK_TYPE",isSelect:!0,isRequire:!0,hasEmpty:!0,selectListName:"attackTypeList",optionTranslationTag:"PROPS.",model:"attackType",onChange:this.setAttackType.bind(this)},{name:"DAMAGE_TYPE",title:"DAMAGE_TYPE",isSelect:!0,isRequire:!0,hasEmpty:!1,selectListName:"damageTypeList",optionTranslationTag:"GENSHIN.DMG.",useNameMap:!0,optionNameMap:this.damageTypeNameMap,model:"damageType",onChange:this.setDamageType.bind(this)},{name:"DAMAGE_TAG",title:"DAMAGE_TAG",isSelect:!0,isRequire:!1,hasEmpty:!0,selectListName:"damageTagList",optionTranslationTag:"TAG.",model:"damageTag",onChange:this.setDamageTag.bind(this)},{name:"MAX_CRIT_RATE",title:"MAX_CRIT_RATE",isInput:!0,isRequire:!0,model:"maxCritRate",onChange:this.setMaxCritRate.bind(this)}],this.inputItems=this.inputItemsMix.concat(),this.maxCritRate=101,this.minCritRate=5,this.initDamageRate=50,this.subsReverseMap=new Map,this.chipChangedForParent=new t.vpe,this.isMixRate=!1,this.userInput=new c.cw({damageRate:new c.NI(0,[c.kI.min(.01),c.kI.required]),damageBase:new c.NI("",c.kI.required),damageRateAttach:new c.NI(0,[c.kI.min(0)]),damageBaseAttach:new c.NI(""),elementType:new c.NI("",c.kI.required),attackType:new c.NI("",c.kI.required),damageType:new c.NI("",c.kI.required),damageTag:new c.NI(""),maxCritRate:new c.NI(0,[c.kI.min(this.minCritRate)])}),this.userInputList={damageBaseList:[],elementTypeList:[],attackTypeList:[],damageTypeList:[],damageTagList:[]},this.currentPoint=new c.NI({value:0,disabled:!0}),this.currentPointInput=new c.NI({value:0,disabled:!0}),this.subsMap.forEach((p,x)=>{this.subsReverseMap.set(p.toString(),x)}),this.effectNum=1,this.setDisplayWith()}setDisplayWith(){this.displayWith=e=>this.percentPipe.transform(e/this.maxValidArray[this.effectNum-1],"1.0-0")}ngOnInit(){this.inputItems.splice(2,2),this.isMixRate=r.hx.PROPS_HAS_MIX_RATE.has(this.characterIndex.toString()),this.initList(),this.initData()}ngOnDestroy(){this.artifactService.saveData()}initData(){var e,n,i,o,l,g,p,x,E,u,m,C,P,S,I,M,Z,W,j,tt,et,nt,at;this.data=this.artifactService.getAllStorageInfo(this.characterIndex,this.index),null===(e=this.userInput.get("damageRate"))||void 0===e||e.setValue(null!==(n=this.data.autoDamageRate)&&void 0!==n?n:this.initDamageRate),null===(i=this.userInput.get("damageBase"))||void 0===i||i.setValue(null!==(o=this.data.autoDamageBase)&&void 0!==o?o:""),null===(l=this.userInput.get("damageRateAttach"))||void 0===l||l.setValue(null!==(g=this.data.autoDamageRateAttach)&&void 0!==g?g:0),null===(p=this.userInput.get("damageBaseAttach"))||void 0===p||p.setValue(null!==(x=this.data.autoDamageBaseAttach)&&void 0!==x?x:""),null===(E=this.userInput.get("elementType"))||void 0===E||E.setValue(null!==(u=this.data.autoElementType)&&void 0!==u?u:""),null===(m=this.userInput.get("attackType"))||void 0===m||m.setValue(null!==(C=this.data.autoAttackType)&&void 0!==C?C:""),null===(P=this.userInput.get("damageType"))||void 0===P||P.setValue(null!==(S=this.data.autoDamageType)&&void 0!==S?S:""),null===(I=this.userInput.get("damageTag"))||void 0===I||I.setValue(null!==(M=this.data.autoDamageTag)&&void 0!==M?M:""),null===(Z=this.userInput.get("maxCritRate"))||void 0===Z||Z.setValue(null!==(W=this.data.autoMaxCritRate)&&void 0!==W?W:this.maxCritRate),this.needUpdate=null===(j=this.data.autoNeedUpdate)||void 0===j||j,this.effectNum=null!==(tt=this.data.autoEffectNum)&&void 0!==tt?tt:0,this.currentPoint.setValue(null!==(et=this.data.autoPropCurrentPoint)&&void 0!==et?et:0),this.currentPointInput.setValue(this.currentPoint.value/10),this.resultCurve=null!==(nt=this.data.autoPropCurve)&&void 0!==nt?nt:"",this.resultCurve.length>0&&(this.currentPoint.enable(),this.currentPointInput.enable()),this.setElementType(null===(at=this.userInput.get("elementType"))||void 0===at?void 0:at.value),this.calcActualProp()}initList(){var e;this.userInputList.damageBaseList=r.hx.PROPS_OPTIMAL_DAMAGE_BASE_LIST,this.userInputList.damageBaseListAttach=r.hx.PROPS_OPTIMAL_DAMAGE_BASE_LIST,this.userInputList.elementTypeList=r.hx.PROPS_OPTIMAL_ELEMENT_TYPE_LIST,this.userInputList.attackTypeList=r.hx.PROPS_OPTIMAL_ATTACK_TYPE_LIST,this.userInputList.damageTypeList=[],this.userInputList.damageTagList=null!==(e=r.hx.PROPS_TAG_MAP.get(this.characterIndex.toString()))&&void 0!==e?e:[],this.resultForCalc=new Uint8Array(this.maxValid)}setDamageRate(e){e!=this.data.autoDamageRate&&this.willNeedUpdate(),this.data.autoDamageRate=e}setDamageBase(e){e!=this.data.autoDamageBase&&this.willNeedUpdate(),this.data.autoDamageBase=e}setDamageRateAttach(e){e!=this.data.autoDamageRateAttach&&this.willNeedUpdate(),this.data.autoDamageRateAttach=e}setDamageBaseAttach(e){e!=this.data.autoDamageBaseAttach&&this.willNeedUpdate(),this.data.autoDamageBaseAttach=e}setElementType(e){e!=this.data.autoElementType&&this.willNeedUpdate(),this.data.autoElementType=e,this.userInputList.damageTypeList=null!=this.userInput.get("elementType").value&&this.userInput.get("elementType").value.length>0?r.hx.PROPS_OPTIMAL_DAMAGE_TYPE_LIST_MAP.get(this.userInput.get("elementType").value):[]}setAttackType(e){e!=this.data.autoAttackType&&this.willNeedUpdate(),this.data.autoAttackType=e}setDamageType(e){e!=this.data.autoDamageType&&this.willNeedUpdate(),this.data.autoDamageType=e}setDamageTag(e){e!=this.data.autoDamageTag&&this.willNeedUpdate(),this.data.autoDamageTag=e}setMaxCritRate(e){e!=this.data.autoMaxCritRate&&this.willNeedUpdate(),this.data.autoMaxCritRate=this.userInput.get("maxCritRate").value}setNeedUpdate(e=!0){this.data.autoNeedUpdate=e}willNeedUpdate(e=!0){this.needUpdate=e,this.setNeedUpdate()}setPropCurve(e){this.data.autoPropCurve=e}setPropEffectNum(e){this.data.autoEffectNum=e}setPropCurrentPoint(e){this.data.autoPropCurrentPoint=e,this.calcActualProp()}resetActualProp(){this.subsSlotMap.forEach((e,n)=>{this.data[e[0]][e[1]].name=n,this.data[e[0]][e[1]].value=0})}calcActualProp(){if(this.currentPoint.value<=this.resultCurve.length){this.resetActualProp();for(let e=0;e<this.currentPoint.value;++e){let n=this.subsReverseMap.get(this.resultCurve[e]),i=this.subsSlotMap.get(n);this.data[i[0]][i[1]].value+=this.genshinDataService.getOptimalReliquaryAffixStep(n)}}this.calculatorService.setDirtyFlag(this.characterIndex),this.updateChips(),this.setDisplayWith()}onChangeCurrentPointSlider(){this.currentPoint.value>this.maxValidArray[this.effectNum-1]&&this.currentPoint.setValue(this.maxValidArray[this.effectNum-1]),this.currentPoint.value<this.minValid&&this.currentPoint.setValue(0),this.currentPointInput.setValue(this.getDisplayValue(this.currentPoint.value)),this.setPropCurrentPoint(this.currentPoint.value)}onChangeCurrentPointInput(){this.currentPointInput.setValue(parseFloat((Math.floor(10*this.currentPointInput.value)/10).toFixed(1))),this.currentPoint.setValue(this.getRowValue(this.currentPointInput.value)),this.onChangeCurrentPointSlider()}updateChips(){this.chipChangedForParent.emit()}optimize(){var e=this;return(0,fe.Z)(function*(){return new Promise(i=>{var o;let l=!1;for(let g in e.userInput.controls){e.userInput.get(g).markAsDirty(),e.userInput.get(g).markAsTouched();const p=null===(o=e.userInput.get(g))||void 0===o?void 0:o.errors;null!=p&&null!=p&&(l=!0)}l||setTimeout(()=>{var g;e.currentPoint.setValue(0),e.currentPointInput.setValue(e.getDisplayValue(e.currentPoint.value)),e.setPropCurrentPoint(e.currentPoint.value);let p={rate:e.userInput.get("damageRate").value/100,base:e.userInput.get("damageBase").value,rateAttach:[],baseAttach:[],elementBonusType:e.userInput.get("elementType").value,attackBonusType:e.userInput.get("attackType").value,tag:null!==(g=e.userInput.get("damageTag").value)&&void 0!==g?g:void 0};e.isMixRate&&0!==e.userInput.get("damageRateAttach").value&&""!==e.userInput.get("damageBase").value&&(p.rateAttach=[[e.userInput.get("damageRateAttach").value/100]],p.baseAttach=[e.userInput.get("damageBaseAttach").value]);let x,E=new Set,u=0,m=e.userInput.get("maxCritRate").value/100,C={};for(let P of e.subs)C[P]=0;for(let P=e.minValid;P<=e.maxValid;++P){let S=Object.assign({},C),I="",M=0;for(let Z of e.subs){let W=S[Z];S[Z]+=e.genshinDataService.getOptimalReliquaryAffixStep(Z),x=e.calculatorService.getDamage(e.characterIndex,p,S),Z==r.hx.PROP_CRIT_RATE&&x.finalCritRate>m||M<x[e.userInput.get("damageType").value]&&(I=Z,e.resultForCalc[P]=e.subsMap.get(I),M=x[e.userInput.get("damageType").value]),S[Z]=W}E.add(I),C[I]+=e.genshinDataService.getOptimalReliquaryAffixStep(I)}u=E.size,e.resultCurve=e.resultForCalc.join(""),e.currentPoint.setValue(e.defaultPoint),e.currentPoint.enable(),e.currentPointInput.setValue(e.defaultPoint/10),e.currentPointInput.enable(),e.effectNum=u>e.maxValidArray.length-1?e.maxValidArray.length-1:u,e.setPropEffectNum(e.effectNum),e.setPropCurve(e.resultCurve),e.setPropCurrentPoint(e.currentPoint.value),e.willNeedUpdate(!1),i()})}).then(()=>{e.translateService.get("AUTO.DONE").subscribe(i=>{e.matSnackBar.open(i,void 0,{duration:1e3})})}).catch(()=>{e.translateService.get("AUTO.FAILED").subscribe(i=>{e.matSnackBar.open(i,void 0,{duration:1e3})})})})()}getRowValue(e,n=10){return parseInt((e*n).toFixed(0))}getDisplayValue(e,n=10){return parseFloat((e/n).toFixed(1))}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(r.bk),t.Y36(r.br),t.Y36(r.RO),t.Y36(_.Zx),t.Y36(xe.ux),t.Y36(O.sK))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-artifact-auto"]],hostBindings:function(e,n){1&e&&t.NdJ("unload",function(){return n.ngOnDestroy()},!1,t.Jf7)},inputs:{characterIndex:"characterIndex",index:"index"},outputs:{chipChangedForParent:"chipChanged"},decls:23,vars:20,consts:[[1,"auto-div"],[3,"formGroup"],[1,"left"],[1,"higher-div"],[3,"innerText"],[1,"right"],[1,"one-line-div"],["color","primary","tickInterval","auto",1,"fiedl-part-1",3,"thumbLabel","formControl","displayWith","max","min","step","change"],["appearance","legacy",1,"fiedl-part-2"],["type","number","matInput","","step","0.1",3,"max","min","formControl","change"],[4,"ngFor","ngForOf"],[1,"button-div","right"],["mat-raised-button","","color","primary",3,"innerText","click"],[1,"tip",3,"innerText"],[4,"ngIf"],["appearance","legacy","floatLabel","always","class","normal-fiedld",4,"ngIf"],["appearance","legacy","floatLabel","always",1,"normal-fiedld"],["matInput","","type","number","step","0.01",3,"formControlName","ngModelChange"],["matSuffix",""],[3,"formControlName","ngModelChange"],["value","",4,"ngIf"],["value",""],[3,"value","innerText",4,"ngIf"],[3,"value","innerText"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"table",1)(2,"tr")(3,"td",2)(4,"div",3),t._UZ(5,"span",4),t.ALo(6,"translate"),t.qZA()(),t.TgZ(7,"td",5)(8,"div",6),t._UZ(9,"br"),t.TgZ(10,"mat-slider",7),t.NdJ("change",function(){return n.onChangeCurrentPointSlider()}),t.qZA(),t.TgZ(11,"mat-form-field",8)(12,"input",9),t.NdJ("change",function(){return n.onChangeCurrentPointInput()}),t.qZA()()()()(),t.YNc(13,Pe,2,1,"ng-container",10),t.qZA(),t.TgZ(14,"div",11)(15,"button",12),t.NdJ("click",function(){return n.optimize()}),t.ALo(16,"translate"),t.qZA()(),t.TgZ(17,"div"),t._UZ(18,"br")(19,"mat-divider")(20,"br")(21,"span",13),t.ALo(22,"translate"),t.qZA()()),2&e&&(t.xp6(1),t.Q6J("formGroup",n.userInput),t.xp6(4),t.Q6J("innerText",t.lcZ(6,14,"AUTO.AUTO_PROGRESS")),t.xp6(5),t.Q6J("thumbLabel",!0)("formControl",n.currentPoint)("displayWith",n.displayWith)("max",n.maxValidArray[n.effectNum-1])("min",n.minValid)("step",n.step),t.xp6(2),t.Q6J("max",n.maxValidArray[n.effectNum-1]/10)("min",n.minValid)("formControl",n.currentPointInput),t.xp6(1),t.Q6J("ngForOf",n.isMixRate?n.inputItemsMix:n.inputItems),t.xp6(2),t.Q6J("innerText",t.lcZ(16,16,"AUTO.CALC")),t.xp6(6),t.Q6J("innerText",t.lcZ(22,18,"AUTO.TIPS")))},directives:[c.JL,c.sg,st.pH,c.JJ,c.oH,L.KE,c.Fd,c.qQ,c.wV,lt.Nt,c.Fj,_.sg,_.O5,L.hX,c.u,L.R9,U.gD,k.ey,K.lW,J.d],pipes:[O.X$],styles:[".auto-div[_ngcontent-%COMP%]{width:95%;padding-left:2%;padding-right:3%;overflow-x:hidden}.button-div[_ngcontent-%COMP%]{width:100%}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.right[_ngcontent-%COMP%]{text-align:right}.left[_ngcontent-%COMP%]{text-align:left}.normal-fiedld[_ngcontent-%COMP%]{width:13em}.one-line-div[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap}.fiedl-part-1[_ngcontent-%COMP%]{width:10em;margin-right:4px}.fiedl-part-2[_ngcontent-%COMP%]{margin-left:.5em;width:2.5em;text-align:center}.higher-div[_ngcontent-%COMP%]{margin-top:.9em;white-space:nowrap;width:2em}.tip[_ngcontent-%COMP%]{color:#0007}input[_ngcontent-%COMP%]::-webkit-outer-spin-button, input[_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}input[type=number][_ngcontent-%COMP%]{-moz-appearance:textfield}"]}),a})();function Oe(a,s){if(1&a&&(t.ynx(0),t._UZ(1,"br")(2,"span",16),t.BQk()),2&a){const e=t.oxw(3);t.xp6(2),t.Q6J("innerHTML",e.effectContent1,t.oJD)}}function Ee(a,s){if(1&a&&(t.ynx(0),t._UZ(1,"br")(2,"span",16),t.BQk()),2&a){const e=t.oxw(3);t.xp6(2),t.Q6J("innerHTML",e.effectContent2,t.oJD)}}function Me(a,s){if(1&a){const e=t.EpF();t.ynx(0),t.TgZ(1,"mat-tab",9),t.ALo(2,"translate"),t.TgZ(3,"div",19),t._UZ(4,"br"),t.TgZ(5,"app-artifact-sub",20),t.NdJ("chipChanged",function(){return t.CHM(e),t.oxw(4).updateChips()}),t.qZA()()(),t.BQk()}if(2&a){const e=s.$implicit,n=t.oxw(2).index,i=t.oxw(2);t.xp6(1),t.Q6J("label",t.lcZ(2,6,"ARTIFACT."+e)),t.xp6(4),t.Q6J("characterIndex",i.data.id)("index",n)("artifactType",e)("changed",i.subChanged)("isAuto",i.isSelectedIndexAuto)}}function ye(a,s){if(1&a){const e=t.EpF();t.TgZ(0,"button",25),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(3).index;return t.oxw(2).rollback(i)}),t.TgZ(1,"mat-icon"),t._uU(2,"replay"),t.qZA(),t._UZ(3,"span",3),t.ALo(4,"translate"),t.qZA()}2&a&&(t.xp6(3),t.Q6J("innerText",t.lcZ(4,1,"SYS.ROLLBACK")))}function Ze(a,s){if(1&a){const e=t.EpF();t.TgZ(0,"button",21)(1,"mat-icon"),t._uU(2,"more_vert"),t.qZA()(),t.TgZ(3,"mat-menu",null,22),t.YNc(5,ye,5,3,"button",23),t.TgZ(6,"button",24),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2).index;return t.oxw(2).removeTab(i)}),t.TgZ(7,"mat-icon"),t._uU(8,"delete"),t.qZA(),t._UZ(9,"span",3),t.ALo(10,"translate"),t.qZA()()}if(2&a){const e=t.MAs(4),n=t.oxw(4);t.Q6J("matMenuTriggerFor",e),t.xp6(5),t.Q6J("ngIf",!n.isSelectedIndexAuto),t.xp6(1),t.Q6J("disabled",n.tabs.length<2),t.xp6(3),t.Q6J("innerText",t.lcZ(10,4,"SYS.DELETE"))}}function Ne(a,s){if(1&a){const e=t.EpF();t.TgZ(0,"mat-tab-group",17),t.NdJ("selectedIndexChange",function(i){return t.CHM(e),t.oxw(3).partIndex=i}),t.YNc(1,Me,6,8,"ng-container",18),t.TgZ(2,"mat-tab",7),t.YNc(3,Ze,11,6,"ng-template",8),t.qZA()()}if(2&a){const e=t.oxw(3);t.Q6J("selectedIndex",e.partIndex),t.xp6(1),t.Q6J("ngForOf",e.artifactList)}}function Re(a,s){if(1&a){const e=t.EpF();t.TgZ(0,"app-artifact-auto",27),t.NdJ("chipChanged",function(){return t.CHM(e),t.oxw(4).updateChips()}),t.qZA()}if(2&a){const e=t.oxw(2).index,n=t.oxw(2);t.Q6J("characterIndex",n.data.id)("index",e)}}function we(a,s){if(1&a&&(t.ynx(0),t._UZ(1,"mat-divider"),t.YNc(2,Re,1,2,"app-artifact-auto",26),t.BQk()),2&a){const e=t.oxw(3);t.xp6(2),t.Q6J("ngIf",e.isSelectedIndexAuto)}}function Je(a,s){if(1&a){const e=t.EpF();t.TgZ(0,"mat-tab",9)(1,"div",10),t._UZ(2,"br"),t.TgZ(3,"app-mat-filtering-selector",11),t.NdJ("modelChange",function(i){return t.CHM(e),t.oxw(2).onSelectArtifactSet(i,0)}),t.qZA(),t._uU(4," \xa0 \xa0 \xa0 \xa0 "),t.TgZ(5,"app-mat-filtering-selector",11),t.NdJ("modelChange",function(i){return t.CHM(e),t.oxw(2).onSelectArtifactSet(i,1)}),t.qZA(),t.YNc(6,Oe,3,1,"ng-container",0),t.YNc(7,Ee,3,1,"ng-container",0),t.TgZ(8,"app-extra-data",12),t._UZ(9,"br")(10,"br")(11,"app-extra-data",12),t.qZA(),t.TgZ(12,"div",13),t._UZ(13,"app-artifact-chips",14),t.qZA()(),t.YNc(14,Ne,4,2,"mat-tab-group",15),t.YNc(15,we,3,1,"ng-container",0),t.qZA()}if(2&a){const e=s.index,n=t.oxw(2);t.Q6J("label","[  "+(e+1)+"  ]"),t.xp6(3),t.Q6J("title","ARTIFACT.SET1")("model",n.selectedArtifactSetIndexs[0])("hasBlankOption",!0)("OriginList",n.artifactSetList)("OptionValueProperty","setId")("OptionInnerTextProperty","setName")("currentLanguage",n.currentLanguage),t.xp6(2),t.Q6J("title","ARTIFACT.SET2")("model",n.selectedArtifactSetIndexs[1])("hasBlankOption",!0)("OriginList",n.artifactSetList)("OptionValueProperty","setId")("OptionInnerTextProperty","setName")("currentLanguage",n.currentLanguage),t.xp6(1),t.Q6J("ngIf",n.selectedArtifactSetIndexs[0]&&""!=n.selectedArtifactSetIndexs[0]),t.xp6(1),t.Q6J("ngIf",n.selectedArtifactSetIndexs[1]&&""!=n.selectedArtifactSetIndexs[1]),t.xp6(1),t.Q6J("characterIndex",n.data.id)("skill",n.name_set)("skillIndex",2)("refreshFlg",n.setBuffRefreshFlg)("valueIndexs",n.effectValidIndexs),t.xp6(3),t.Q6J("characterIndex",n.data.id)("skill",n.name_set)("skillIndex",1)("refreshFlg",n.setBuffRefreshFlg)("valueIndexs",n.effectValidIndexs),t.xp6(2),t.Q6J("characterIndex",n.data.id)("index",e)("isFull",!0)("isAuto",n.isSelectedIndexAuto)("changed",n.chipChanged),t.xp6(1),t.Q6J("ngIf",n.selectedIndex==e),t.xp6(1),t.Q6J("ngIf",n.selectedIndex==e&&n.isSelectedIndexAuto)}}function De(a,s){if(1&a){const e=t.EpF();t.TgZ(0,"button",28),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).copyTab()}),t.TgZ(1,"mat-icon"),t._uU(2,"content_copy"),t.qZA()(),t.TgZ(3,"button",29),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).addTab()}),t.TgZ(4,"mat-icon"),t._uU(5,"add_circle"),t.qZA()(),t.TgZ(6,"button",30),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).addAutoTab()}),t.TgZ(7,"mat-icon"),t._uU(8,"queue_play_next"),t.qZA()()}}function Fe(a,s){if(1&a){const e=t.EpF();t.ynx(0),t.TgZ(1,"mat-card",1)(2,"mat-card-header",2),t._UZ(3,"mat-card-title",3),t.ALo(4,"translate"),t.qZA(),t.TgZ(5,"mat-card-content",4),t._UZ(6,"mat-divider"),t.TgZ(7,"mat-tab-group",5),t.NdJ("selectedIndexChange",function(i){return t.CHM(e),t.oxw().selectedIndex=i})("selectedIndexChange",function(){return t.CHM(e),t.oxw().setActiveIndex()}),t.YNc(8,Je,16,34,"mat-tab",6),t.TgZ(9,"mat-tab",7),t.YNc(10,De,9,0,"ng-template",8),t.qZA()()()(),t.BQk()}if(2&a){const e=t.oxw();t.xp6(1),t.Udp("width",e.cardWidth,"px"),t.xp6(2),t.Q6J("innerText",t.lcZ(4,5,"ARTIFACT.NAME")),t.xp6(4),t.Q6J("selectedIndex",e.selectedIndex),t.xp6(1),t.Q6J("ngForOf",e.tabs)}}let Ue=(()=>{class a{constructor(e,n){this.artifactService=e,this.calculatorService=n,this.no_desc={cn_sim:"",cn_tra:"",en:"",jp:""},this.name_set=r.hx.NAME_SET,this.artifactList=[r.hx.ARTIFACT_FLOWER,r.hx.ARTIFACT_PLUME,r.hx.ARTIFACT_SANDS,r.hx.ARTIFACT_GOBLET,r.hx.ARTIFACT_CIRCLET],this.draged=new t.vpe,this.tabs=[],this.artifactSetList=[],this.isSelectedIndexAuto=!1,this.selectedFullArtifactSetIndex="",this.effectContent1="",this.effectContent2="",this.partIndex=0,this.subChanged=0,this.chipChanged=0,this.setBuffRefreshFlg=0}ngOnInit(){this.initializeArtifactSetList();let e=this.artifactService.getStorageInfoLength(this.data.id);(null==e||0==e)&&(e=1),this.tabs=Array.from({length:e}).map((n,i)=>`${i}`),this.selectedIndex=this.artifactService.getStorageActiveIndex(this.data.id),this.isSelectedIndexAuto=this.artifactService.getStorageActiveIndexAutoFlag(this.data.id),this.initSelectedArtifactSetIndexs(!0)}ngOnChanges(e){e.currentLanguage&&this.selectedArtifactSetIndexs&&this.selectedArtifactSetIndexs.length>0&&this.initEffectContents()}updateRecords(){this.effectValidIndexs=this.getEffectValidIndexs()}addTab(){this.tabs.push((this.tabs.length+1).toString()),this.selectedIndex=this.tabs.length-1,this.setActiveIndex()}addAutoTab(){this.tabs.push((this.tabs.length+1).toString()),this.selectedIndex=this.tabs.length-1,this.artifactService.pushStorageInfo(this.data.id,{isAuto:!0}),this.setActiveIndex()}copyTab(){this.artifactService.copyAndCreateStorageInfo(this.data.id,this.selectedIndex),this.addTab()}removeTab(e){if(this.tabs.splice(e,1),this.artifactService.deleteStorageInfo(this.data.id,e),this.selectedIndex>=e){let n=this.tabs.length-1;this.selectedIndex=n>0?n:0,this.setActiveIndex()}else this.selectedIndex=0,this.setActiveIndex()}rollback(e){this.artifactService.recoverData(this.data.id,e),this.subChanged+=1,this.initSelectedArtifactSetIndexs(!0),this.calculatorService.setDirtyFlag(this.data.id)}setActiveIndex(){this.artifactService.setStorageActiveIndex(this.data.id,this.selectedIndex),this.initSelectedArtifactSetIndexs(),this.calculatorService.setDirtyFlag(this.data.id),this.isSelectedIndexAuto=this.artifactService.getStorageActiveIndexAutoFlag(this.data.id)}onSelectArtifactSet(e,n){this.selectedArtifactSetIndexs[n]=e,y.N.outputLog&&console.log(this.artifactService.getSetData(e)),this.initSelectedFullArtifactSetIndex(),this.initEffectContents(),this.setDefaultExtraData(),this.calculatorService.initExtraArtifactSetData(this.data.id)}getEffectValidIndexs(){return""!=this.selectedFullArtifactSetIndex?this.artifactService.getSetData(this.selectedFullArtifactSetIndex).setAffixs[1].paramValidIndexs:[]}initEffectContents(){this.effectContent1=this.getEffectContent(1)[this.currentLanguage].length>0?y.N.artifactEffectContentPreffix+this.getEffectContent(1)[this.currentLanguage]:"",this.effectContent2=this.getEffectContent(2)[this.currentLanguage].length>0?y.N.artifactEffectContentPreffix+this.getEffectContent(2)[this.currentLanguage]:""}getEffectContent(e){var n,i;let o=this.selectedArtifactSetIndexs[e-1];if(null==o)return this.no_desc;let l=0;return 2==e&&o==this.selectedFullArtifactSetIndex&&(l=1),null!==(i=null===(n=this.artifactService.getSetData(o))||void 0===n?void 0:n.setAffixs[l].desc)&&void 0!==i?i:this.no_desc}updateChips(){this.chipChanged+=1}onDrag(){this.draged.emit(this.name)}initializeArtifactSetList(){this.artifactSetList=[];let e=this.artifactService.getSetMap();for(let n in e)this.artifactSetList.push({setId:n,setName:e[n].setName,setAffixs:e[n].setAffixs})}initSelectedArtifactSetIndexs(e){this.selectedArtifactSetIndexs=this.artifactService.getStorageSetIndexs(this.data.id,this.selectedIndex),this.initSelectedFullArtifactSetIndex(e),this.initEffectContents(),e||this.setDefaultExtraData(),this.calculatorService.initExtraArtifactSetData(this.data.id),++this.setBuffRefreshFlg}initSelectedFullArtifactSetIndex(e){this.selectedArtifactSetIndexs[0]==this.selectedArtifactSetIndexs[1]&&""!=this.selectedArtifactSetIndexs[0]&&this.selectedArtifactSetIndexs[0]?(this.selectedFullArtifactSetIndex=this.selectedArtifactSetIndexs[0],this.artifactService.setStorageFullSetIndex(this.data.id,this.selectedIndex,this.selectedFullArtifactSetIndex)):(this.selectedFullArtifactSetIndex="",this.artifactService.setStorageFullSetIndex(this.data.id,this.selectedIndex,"",e)),this.updateRecords()}setDefaultExtraData(){this.artifactService.setDefaultExtraData(this.data.id,this.selectedArtifactSetIndexs,this.selectedFullArtifactSetIndex)}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(r.bk),t.Y36(r.RO))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-artifact"]],inputs:{data:"data",currentLanguage:["language","currentLanguage"],cardWidth:"cardWidth",zIndex:"zIndex",name:"name"},outputs:{draged:"draged"},features:[t.TTD],decls:1,vars:1,consts:[[4,"ngIf"],[1,"card"],[1,"header"],[3,"innerText"],[1,"content"],["animationDuration","0",3,"selectedIndex","selectedIndexChange"],[3,"label",4,"ngFor","ngForOf"],["disabled",""],["mat-tab-label",""],[3,"label"],[1,"artifact-set"],[1,"set-field",3,"title","model","hasBlankOption","OriginList","OptionValueProperty","OptionInnerTextProperty","currentLanguage","modelChange"],[3,"characterIndex","skill","skillIndex","refreshFlg","valueIndexs"],[1,"chip-div"],[3,"characterIndex","index","isFull","isAuto","changed"],["mat-stretch-tabs","",3,"selectedIndex","selectedIndexChange",4,"ngIf"],[3,"innerHTML"],["mat-stretch-tabs","",3,"selectedIndex","selectedIndexChange"],[4,"ngFor","ngForOf"],[1,"artifact-sub"],[3,"characterIndex","index","artifactType","changed","isAuto","chipChanged"],["mat-icon-button","",3,"matMenuTriggerFor"],["menu","matMenu"],["mat-menu-item","",3,"click",4,"ngIf"],["mat-menu-item","",3,"disabled","click"],["mat-menu-item","",3,"click"],[3,"characterIndex","index","chipChanged",4,"ngIf"],[3,"characterIndex","index","chipChanged"],["mat-icon-button","","matTooltip","Copy","matTooltipPosition","above",1,"add-button",3,"click"],["mat-icon-button","","matTooltip","Add","matTooltipPosition","above",1,"add-button",3,"click"],["mat-icon-button","","matTooltip","Add Auto","matTooltipPosition","above",1,"add-button",3,"click"]],template:function(e,n){1&e&&t.YNc(0,Fe,11,7,"ng-container",0),2&e&&t.Q6J("ngIf",n.data.skills.normal.name)},directives:[_.O5,f.a8,f.dk,f.n5,f.dn,J.d,B.SP,_.sg,B.uX,$.X,V.f,rt,ue,B.uD,K.lW,Y.p6,X.Hw,Y.VK,Y.OP,be,D.gM],pipes:[O.X$],styles:[".card[_ngcontent-%COMP%]{max-width:350px;min-width:290px;margin:12px}.avatar[_ngcontent-%COMP%]{width:80px;height:80px;background-size:cover;margin-top:10px;margin-bottom:5px;border-radius:0%}.header-text[_ngcontent-%COMP%]{font-size:inherit}.content[_ngcontent-%COMP%]{padding-top:2px}.expand[_ngcontent-%COMP%]{margin-top:1px}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:first-child   .content-left[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:first-child   .content-right[_ngcontent-%COMP%]{border-top:1px solid rgba(0,0,0,.12)}.content-left[_ngcontent-%COMP%]{text-align:left;border-bottom:1px solid rgba(0,0,0,.12)}.content-right[_ngcontent-%COMP%]{text-align:right;border-bottom:1px solid rgba(0,0,0,.12)}.content-right-button[_ngcontent-%COMP%]{text-align:center;border-bottom:none}.drap-handle[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px;color:#ccc;cursor:move;width:24px;height:24px}[_nghost-%COMP%]     .mat-tab-label, [_nghost-%COMP%]     .mat-tab-label-active{min-width:0!important;padding:3px!important;margin:3px!important}.add-button[_ngcontent-%COMP%]{width:30px}[_nghost-%COMP%]     .set-field mat-form-field{width:140px}.artifact-set[_ngcontent-%COMP%]{margin-left:2%;width:94%;margin-right:2%}.artifact-sub[_ngcontent-%COMP%]{margin-left:2%;width:96%;height:99%;overflow-y:hidden;overflow-x:hidden}.chip-div[_ngcontent-%COMP%]{padding-top:.5em;padding-bottom:.1em}"],changeDetection:0}),a})();var ke=h(2368);function Qe(a,s){1&a&&(t.TgZ(0,"span",19),t._uU(1,"%\xa0"),t.qZA())}function Be(a,s){if(1&a){const e=t.EpF();t.TgZ(0,"mat-tab",8)(1,"div",9)(2,"div",10)(3,"button",11)(4,"mat-icon"),t._uU(5,"more_vert"),t.qZA()(),t.TgZ(6,"mat-menu",null,12)(8,"button",13),t.NdJ("click",function(){const o=t.CHM(e).index;return t.oxw(2).removeTab(o)}),t.TgZ(9,"mat-icon"),t._uU(10,"delete"),t.qZA(),t._UZ(11,"span",2),t.ALo(12,"translate"),t.qZA()()(),t._UZ(13,"br"),t.TgZ(14,"app-mat-filtering-selector",14),t.NdJ("modelChange",function(i){t.CHM(e);const o=t.oxw(2);return o.onSelectProp(i,o.selectedIndex)}),t.qZA(),t._UZ(15,"br"),t.TgZ(16,"mat-form-field",15),t._UZ(17,"mat-label",2),t.ALo(18,"translate"),t.TgZ(19,"input",16),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw(2).showValue=i})("keyup",function(i){return t.CHM(e),t.oxw(2).onValueKeyup(i)}),t.qZA(),t.YNc(20,Qe,2,0,"span",17),t.qZA(),t.TgZ(21,"mat-slide-toggle",18),t.NdJ("ngModelChange",function(i){t.CHM(e);const o=t.oxw(2);return o.infos[o.selectedIndex].enable=i})("ngModelChange",function(){return t.CHM(e),t.oxw(2).updateDirtyFlag()}),t.qZA(),t._UZ(22,"br")(23,"br"),t.qZA()()}if(2&a){const e=s.index,n=t.MAs(7),i=t.oxw(2);let o;t.Q6J("label","[  "+(e+1)+"  ]"),t.xp6(3),t.Q6J("matMenuTriggerFor",n),t.xp6(5),t.Q6J("disabled",i.tabs.length<2),t.xp6(3),t.Q6J("innerText",t.lcZ(12,14,"SYS.DELETE")),t.xp6(3),t.Q6J("title","OTHER.TARGET")("model",i.infos[i.selectedIndex].name)("OriginList",i.propList)("OptionValueProperty","value")("OptionInnerTextProperty","names")("currentLanguage",i.currentLanguage),t.xp6(3),t.Q6J("innerText",t.lcZ(18,16,"OTHER.TARGETVALUE")),t.xp6(2),t.Q6J("ngModel",i.showValue),t.xp6(1),t.Q6J("ngIf",i.props_all_percent.includes(null!==(o=i.infos[i.selectedIndex].name)&&void 0!==o?o:"")),t.xp6(1),t.Q6J("ngModel",i.infos[i.selectedIndex].enable)}}function Ye(a,s){if(1&a){const e=t.EpF();t.TgZ(0,"button",20),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).copyTab()}),t.TgZ(1,"mat-icon"),t._uU(2,"content_copy"),t.qZA()(),t.TgZ(3,"button",21),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).addTab()}),t.TgZ(4,"mat-icon"),t._uU(5,"add_circle"),t.qZA()()}}function We(a,s){if(1&a){const e=t.EpF();t.ynx(0),t.TgZ(1,"mat-card",1)(2,"mat-card-header"),t._UZ(3,"mat-card-title",2),t.ALo(4,"translate"),t.qZA(),t.TgZ(5,"mat-card-content",3),t._UZ(6,"mat-divider"),t.TgZ(7,"mat-tab-group",4),t.NdJ("selectedIndexChange",function(i){return t.CHM(e),t.oxw().selectedIndex=i})("selectedIndexChange",function(){return t.CHM(e),t.oxw().onTabChanged()}),t.YNc(8,Be,24,18,"mat-tab",5),t.TgZ(9,"mat-tab",6),t.YNc(10,Ye,6,0,"ng-template",7),t.qZA()()()(),t.BQk()}if(2&a){const e=t.oxw();t.xp6(1),t.Udp("width",e.cardWidth,"px"),t.xp6(2),t.Q6J("innerText",t.lcZ(4,5,"OTHER.NAME")),t.xp6(4),t.Q6J("selectedIndex",e.selectedIndex),t.xp6(1),t.Q6J("ngForOf",e.tabs)}}let He=(()=>{class a{constructor(e,n,i){this.otherService=e,this.calculatorService=n,this.translateService=i,this.props_all_percent=r.hx.PROPS_ALL_DATA_PERCENT,this.tabs=[],this.propList=[],this.draged=new t.vpe}ngOnInit(){this.propList=Array.from(r.hx.PROPS_OTHER,(n,i)=>{let o={};for(let l of r.hx.LIST_LANG)o[l.code]="";return{value:n,names:o}}),this.updateNames();let e=this.otherService.getStorageInfoLength(this.data.id);(null==e||0==e)&&(e=1),this.tabs=Array.from({length:e}).map((n,i)=>`${i}`),this.selectedIndex=this.otherService.getStorageSelectedIndex(this.data.id),this.initInfos(),this.updateShowValue()}ngOnChanges(e){e.currentLanguage&&this.updateNames()}ngOnDestroy(){this.otherService.saveData()}addTab(){this.otherService.addStorageInfo(this.data.id),this.localAddTab(),this.setSelectedIndex()}copyTab(){this.otherService.copyAndCreateStorageInfo(this.data.id,this.selectedIndex),this.localAddTab(),this.setSelectedIndex(),this.updateDirtyFlag()}removeTab(e){if(this.tabs.splice(e,1),this.otherService.deleteStorageInfo(this.data.id,e),this.selectedIndex>=e){let n=this.tabs.length-1;this.selectedIndex=n>0?n:0,this.setSelectedIndex()}else this.selectedIndex=0,this.setSelectedIndex();this.updateDirtyFlag()}onTabChanged(){this.updateShowValue()}setSelectedIndex(){this.otherService.setStorageSelectedIndex(this.data.id,this.selectedIndex),this.updateShowValue()}onSelectProp(e,n){this.infos[n].name=e,this.infos[this.selectedIndex].value=0,this.updateShowValue(),this.updateDirtyFlag()}onValueKeyup(e){var n;let o=parseFloat(e.target.value);isNaN(o)&&(o=0),this.props_all_percent.includes(null!==(n=this.infos[this.selectedIndex].name)&&void 0!==n?n:"")&&(o/=100),this.infos[this.selectedIndex].value=o,this.updateDirtyFlag()}updateDirtyFlag(){this.calculatorService.setDirtyFlag(this.data.id)}onDrag(){this.draged.emit(this.name)}localAddTab(){this.tabs.push((this.tabs.length+1).toString()),this.selectedIndex=this.tabs.length-1}initInfos(){this.infos=this.otherService.getStorageInfos(this.data.id)}updateShowValue(){var e;let n=this.infos[this.selectedIndex].value;this.props_all_percent.includes(null!==(e=this.infos[this.selectedIndex].name)&&void 0!==e?e:"")&&(n*=100),this.showValue=parseFloat(n.toFixed(8))}updateNames(){var e;null===(e=this.propList)||void 0===e||e.forEach(n=>{this.translateService.get("PROPS."+n.value.toUpperCase()).subscribe(i=>{n.names[this.currentLanguage]=i})})}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(r.mi),t.Y36(r.RO),t.Y36(O.sK))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-other"]],hostBindings:function(e,n){1&e&&t.NdJ("unload",function(){return n.ngOnDestroy()},!1,t.Jf7)},inputs:{data:"data",currentLanguage:["language","currentLanguage"],cardWidth:"cardWidth",zIndex:"zIndex",name:"name"},outputs:{draged:"draged"},features:[t.TTD],decls:1,vars:1,consts:[[4,"ngIf"],[1,"card"],[3,"innerText"],[1,"content"],["animationDuration","0",3,"selectedIndex","selectedIndexChange"],[3,"label",4,"ngFor","ngForOf"],["disabled",""],["mat-tab-label",""],[3,"label"],[1,"tab"],[1,"menu-div"],["mat-icon-button","",3,"matMenuTriggerFor"],["menu","matMenu"],["mat-menu-item","",3,"disabled","click"],[1,"prop-field",3,"title","model","OriginList","OptionValueProperty","OptionInnerTextProperty","currentLanguage","modelChange"],["appearance","legacy","floatLabel","always",1,"normal-fiedld"],["matInput","","type","number","step","0.01",3,"ngModel","ngModelChange","keyup"],["matSuffix","",4,"ngIf"],["color","primary",1,"switch",3,"ngModel","ngModelChange"],["matSuffix",""],["mat-icon-button","","matTooltip","Copy","matTooltipPosition","above",1,"add-button",3,"click"],["mat-icon-button","","matTooltip","Add","matTooltipPosition","above",1,"add-button",3,"click"]],template:function(e,n){1&e&&t.YNc(0,We,11,7,"ng-container",0),2&e&&t.Q6J("ngIf",n.data.skills.normal.name)},directives:[_.O5,f.a8,f.dk,f.n5,f.dn,J.d,B.SP,_.sg,B.uX,K.lW,Y.p6,X.Hw,Y.VK,Y.OP,$.X,L.KE,L.hX,lt.Nt,c.wV,c.Fj,c.JJ,c.On,L.R9,ke.Rr,B.uD,D.gM],pipes:[O.X$],styles:[".card[_ngcontent-%COMP%]{max-width:350px;min-width:290px;margin:12px;transition:box-shadow .5s}.avatar[_ngcontent-%COMP%]{width:80px;height:80px;background-size:cover;margin-top:10px;margin-bottom:5px;border-radius:0%}.header-text[_ngcontent-%COMP%]{font-size:inherit}.content[_ngcontent-%COMP%]{padding-top:2px}.expand[_ngcontent-%COMP%]{margin-top:1px}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:first-child   .content-left[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:first-child   .content-right[_ngcontent-%COMP%]{border-top:1px solid rgba(0,0,0,.12)}.content-left[_ngcontent-%COMP%]{text-align:left;border-bottom:1px solid rgba(0,0,0,.12)}.content-right[_ngcontent-%COMP%]{text-align:right;border-bottom:1px solid rgba(0,0,0,.12)}.content-right-button[_ngcontent-%COMP%]{text-align:center;border-bottom:none}.drap-handle[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px;color:#ccc;cursor:move;width:24px;height:24px}  .mat-tab-label,   .mat-tab-label-active{min-width:0!important;padding:3px!important;margin:3px!important}.add-button[_ngcontent-%COMP%]{width:30px}.menu-div[_ngcontent-%COMP%]{float:right}.switch[_ngcontent-%COMP%]{transform:translate(68px,5px)}.tab[_ngcontent-%COMP%]{height:100%;margin-left:2%;width:96%}[_nghost-%COMP%]     .prop-field mat-form-field{width:280px}input[_ngcontent-%COMP%]::-webkit-outer-spin-button, input[_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}input[type=number][_ngcontent-%COMP%]{-moz-appearance:textfield}.normal-fiedld[_ngcontent-%COMP%]{width:13em}"]}),a})();function Ve(a,s){if(1&a&&(t.TgZ(0,"div",4),t._UZ(1,"div",4),t.qZA()),2&a){const e=t.oxw();t.Udp("right",e.scrollBarWidth+"px")("background-image","url("+e.backgroundURL+")"),t.Q6J("@imgLoad",e.imgState)}}const N="beforeLoad",F="loaded",qe=[{path:"",component:(()=>{class a{constructor(e,n,i,o,l,g,p){this.httpService=e,this.route=n,this.characterService=i,this.calculatorService=o,this.languageService=l,this.breakpointObserver=g,this.relayoutMsgService=p,this.name_character="character",this.name_enemy="enemy",this.name_weapon="weapon",this.name_artifact="artifact",this.name_talent="talent",this.name_constellation="constellation",this.name_other="other",this.childNameMap={character:"0",enemy:"1",weapon:"2",artifact:"3",talent:"4",constellation:"5",other:"6"},this.childNames=["0","1","2","3","4","5","6"],this.imgState=N,this.otherState=N,this.isLargeFlg=!0,this.destroyed=new R.x,this.subscriptions=[],this.subscriptions.push(this.relayoutMsgService.status().subscribe(()=>{setTimeout(()=>{this.reLayout()})})),this.subscriptions.push(this.calculatorService.changed().subscribe(()=>{setTimeout(()=>{this.reLayout()})})),this.zIndexs=[],this.childZIndexs={},this.refreshChildZIndexs(),this.isLarge=this.breakpointObserver.observe(["(min-width: 700px)"]).pipe((0,Q.R)(this.destroyed),(0,w.U)(x=>x.matches)),this.isLarge.subscribe(x=>{this.scrollBarWidth=9}),this.currentLanguage=this.languageService.getCurrentLang(),this.languageService.getLang().subscribe(x=>{this.currentLanguage=x}),setTimeout(()=>{this.otherState=F},100)}ngOnInit(){this.route.queryParams.subscribe(e=>{this.data=this.characterService.get(e.index),this.currentCharacterIndex=e.index.toString(),this.initializeBackGroundImage(),this.characterService.setDefaultExtraData(e.index),this.calculatorService.initCharacterData(e.index),y.N.outputLog&&console.log(this.data),setTimeout(()=>{this.magicGrid=new(z())({container:".content",items:7,gutter:8,maxColumns:4,animate:!0,useMin:!0}),this.magicGrid.listen()})}),this.screenWidth=window.innerWidth,this.setCardWidth=this.screenWidth-65}ngOnDestroy(){this.backgroundLoadFlg=!1,this.otherState=N,this.imgState=N,this.destroyed.next(),this.destroyed.complete(),this.magicGrid=null;for(let e of this.subscriptions)e&&!(null==e?void 0:e.closed)&&e.unsubscribe()}initializeBackGroundImage(){if(!this.backgroundURL){let e=this.data.images.background;e&&this.httpService.get(e,"blob").then(n=>{n&&(this.backgroundURL=window.URL.createObjectURL(n),setTimeout(()=>{this.imgState=F},100))}).catch(()=>{})}}onWindowResize(){this.screenWidth=window.innerWidth,this.setCardWidth=this.screenWidth-65}onChildStartDrag(e){this.childNameMap[e]!=this.zIndexs[this.zIndexs.length-1]&&(this.zIndexs.push(this.childNameMap[e]),this.refreshChildZIndexs())}refreshChildZIndexs(){for(let e of this.childNames)this.childZIndexs[e]=this.zIndexs.lastIndexOf(e)+1}ngAfterViewChecked(){}reLayout(){var e;(null===(e=this.magicGrid)||void 0===e?void 0:e.ready())&&this.magicGrid.positionItems()}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(r.OE),t.Y36(b.gz),t.Y36(r.AE),t.Y36(r.RO),t.Y36(r.TS),t.Y36(dt.Yg),t.Y36(r.NA))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-main"]],hostBindings:function(e,n){1&e&&t.NdJ("resize",function(o){return n.onWindowResize(o)},!1,t.Jf7)},decls:10,vars:37,consts:[[1,"main"],["class","background",3,"right","background-image",4,"ngIf"],[1,"content"],[3,"data","language","cardWidth","zIndex","name","draged"],[1,"background"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t.YNc(1,Ve,2,5,"div",1),t.TgZ(2,"div",2)(3,"app-character",3),t.NdJ("draged",function(o){return n.onChildStartDrag(o)}),t.qZA(),t.TgZ(4,"app-weapon",3),t.NdJ("draged",function(o){return n.onChildStartDrag(o)}),t.qZA(),t.TgZ(5,"app-talent",3),t.NdJ("draged",function(o){return n.onChildStartDrag(o)}),t.qZA(),t.TgZ(6,"app-constellation",3),t.NdJ("draged",function(o){return n.onChildStartDrag(o)}),t.qZA(),t.TgZ(7,"app-enemy",3),t.NdJ("draged",function(o){return n.onChildStartDrag(o)}),t.qZA(),t.TgZ(8,"app-artifact",3),t.NdJ("draged",function(o){return n.onChildStartDrag(o)}),t.qZA(),t.TgZ(9,"app-other",3),t.NdJ("draged",function(o){return n.onChildStartDrag(o)}),t.qZA()()()),2&e&&(t.xp6(1),t.Q6J("ngIf",n.backgroundURL),t.xp6(1),t.Q6J("@otherLoad",n.otherState),t.xp6(1),t.Q6J("data",n.data)("language",n.currentLanguage)("cardWidth",n.setCardWidth)("zIndex",n.childZIndexs[n.childNameMap[n.name_character]])("name",n.name_character),t.xp6(1),t.Q6J("data",n.data)("language",n.currentLanguage)("cardWidth",n.setCardWidth)("zIndex",n.childZIndexs[n.childNameMap[n.name_weapon]])("name",n.name_weapon),t.xp6(1),t.Q6J("data",n.data)("language",n.currentLanguage)("cardWidth",n.setCardWidth)("zIndex",n.childZIndexs[n.childNameMap[n.name_talent]])("name",n.name_talent),t.xp6(1),t.Q6J("data",n.data)("language",n.currentLanguage)("cardWidth",n.setCardWidth)("zIndex",n.childZIndexs[n.childNameMap[n.name_constellation]])("name",n.name_constellation),t.xp6(1),t.Q6J("data",n.data)("language",n.currentLanguage)("cardWidth",n.setCardWidth)("zIndex",n.childZIndexs[n.childNameMap[n.name_enemy]])("name",n.name_enemy),t.xp6(1),t.Q6J("data",n.data)("language",n.currentLanguage)("cardWidth",n.setCardWidth)("zIndex",n.childZIndexs[n.childNameMap[n.name_artifact]])("name",n.name_artifact),t.xp6(1),t.Q6J("data",n.data)("language",n.currentLanguage)("cardWidth",n.setCardWidth)("zIndex",n.childZIndexs[n.childNameMap[n.name_other]])("name",n.name_other))},directives:[_.O5,vt,Mt,Vt,Gt,ne,Ue,He],styles:[".main[_ngcontent-%COMP%]{height:100%;overflow-x:hidden;overflow-y:hidden}.content[_ngcontent-%COMP%]{padding:6px}.background[_ngcontent-%COMP%]{position:fixed;bottom:0;background-position:right top;background-size:cover;z-index:-10;min-height:100%;width:100%}.background-content[_ngcontent-%COMP%]{position:fixed;min-height:100%;width:100%}.middle[_ngcontent-%COMP%]{margin-top:24px}"],data:{animation:[(0,T.X$)("imgLoad",[(0,T.SB)(N,(0,T.oB)({opacity:.01})),(0,T.SB)(F,(0,T.oB)({opacity:.16})),(0,T.eR)(N+"=>"+F,[(0,T.jt)("1s")]),(0,T.eR)(F+"=>"+N,[(0,T.jt)("0.2s")])]),(0,T.X$)("otherLoad",[(0,T.SB)(N,(0,T.oB)({opacity:.01})),(0,T.SB)(F,(0,T.oB)({opacity:1})),(0,T.eR)(N+"=>"+F,[(0,T.jt)("0.5s")]),(0,T.eR)(F+"=>"+N,[(0,T.jt)("0.2s")])])]}}),a})()}];let ze=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({imports:[[b.Bz.forChild(qe)],b.Bz]}),a})(),Ge=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({providers:[_.Zx,_.JJ,r.od,r.dG,r.W7],imports:[[c.u5,c.UX,_.ez,d.o9,A.h,ze,r.m8]]}),a})()},1547:function(it){it.exports=function(){"use strict";var h=function(d){throw new Error("Missing property '"+d+"' in MagicGrid config")},c=function(d){(function(d){if(!d)throw new Error("No config object has been provided.");"boolean"!=typeof d.useTransform&&(d.useTransform=!0),"number"!=typeof d.gutter&&(d.gutter=25),d.container||h("container"),d.items||d.static||h("items or static")})(d),d.container instanceof HTMLElement?(this.container=d.container,this.containerClass=d.container.className):(this.containerClass=d.container,this.container=document.querySelector(d.container)),this.items=this.container.children,this.static=d.static||!1,this.size=d.items,this.gutter=d.gutter,this.maxColumns=d.maxColumns||!1,this.useMin=d.useMin||!1,this.useTransform=d.useTransform,this.animate=d.animate||!1,this.started=!1,this.init()};return c.prototype.init=function(){if(this.ready()&&!this.started){this.container.style.position="relative";for(var d=0;d<this.items.length;d++){var A=this.items[d].style;A.position="absolute",this.animate&&(A.transition=(this.useTransform?"transform":"top, left")+" 0.2s ease")}this.started=!0}},c.prototype.colWidth=function(){return this.items[0].getBoundingClientRect().width+this.gutter},c.prototype.setup=function(){var d=this.container.getBoundingClientRect().width,A=this.colWidth(),b=Math.floor(d/A)||1,T=[];this.maxColumns&&b>this.maxColumns&&(b=this.maxColumns);for(var R=0;R<b;R++)T[R]={height:0,index:R};return{cols:T,wSpace:d-b*A+this.gutter}},c.prototype.nextCol=function(d,A){return this.useMin?function(d){var A=d[0];for(var b of d)b.height<A.height&&(A=b);return A}(d):d[A%d.length]},c.prototype.positionItems=function(){var d=this.setup(),A=d.cols,b=d.wSpace,T=0,R=this.colWidth();b=Math.floor(b/2);for(var Q=0;Q<this.items.length;Q++){var w=this.nextCol(A,Q),y=this.items[Q],q=w.height?this.gutter:0,z=w.index*R+b+"px",t=w.height+q+"px";this.useTransform?y.style.transform="translate("+z+", "+t+")":(y.style.top=t,y.style.left=z),w.height+=y.getBoundingClientRect().height+q,w.height>T&&(T=w.height)}this.container.style.height=T+"px"},c.prototype.ready=function(){return!!this.static||this.items.length>=this.size},c.prototype.getReady=function(){var d=this,A=setInterval(function(){d.container=document.querySelector(d.containerClass),d.items=d.container.children,d.ready()&&(clearInterval(A),d.init(),d.listen())},100)},c.prototype.listen=function(){var A,d=this;this.ready()?(window.addEventListener("resize",function(){A||(A=setTimeout(function(){d.positionItems(),A=null},200))}),this.positionItems()):this.getReady()},c}()}}]);